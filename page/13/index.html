<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#33363b">
    <meta name="msapplication-TileColor" content="#33363b">
    
    
    
    
    <meta name="keywords" content="leinlin, ARIA, Hexo">
    
    
    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
    
    
    <link rel="icon" type="image/png" sizes="192x192" href="/favicons/android-chrome-192x192.png">
    
    
    <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
    
    
    <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
    
    
    <link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#33363b">
    
    
    <link rel="manifest" href="/favicons/site.webmanifest">
    
    
    <meta name="msapplication-config" content="/favicons/browserconfig.xml">
    
    
    <link rel="alternate" href="/atom.xml" title="leinlin的小笔记" type="application/atom+xml" />
    
    
    <link rel="shortcut icon" type="image/x-icon" href="/favicons/favicon.ico">
    
    
    <link rel="stylesheet" type="text/css" href="/css/normalize.css">
    <link rel="stylesheet" type="text/css" href="/css/index.css">
    
    <link rel="stylesheet" type="text/css" href="/css/sidebar.css">
    
    
<link rel="stylesheet" type="text/css" href="/css/page.css">
<link rel="stylesheet" type="text/css" href="/css/post.css">

    <link rel="stylesheet" type="text/css" href="/css/custom.css">
    <link rel="stylesheet" type="text/css" href="/css/atom-one-light.css">
    <link rel="stylesheet" type="text/css" href="/css/lightgallery.min.css">
    <script type="text/javascript" src="/js/jquery.min.js"></script>
    <script defer type="text/javascript" src="/js/util.js"></script>
    <script defer type="text/javascript" src="/js/clipboard.min.js"></script>
    <script defer type="text/javascript" src="/js/scrollspy.js"></script>
    <script defer type="text/javascript" src="/js/fontawesome-all.min.js"></script>
    <script defer type="text/javascript" src="/js/lightgallery.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-fullscreen.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-hash.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-pager.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-thumbnail.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-zoom.min.js"></script>
    
    <script defer src="/js/busuanzi.pure.mini.js"></script>
    
    
    <script defer type="text/javascript" src="/js/search.js"></script>
    <script type="text/javascript">
    $(document).ready(function () {
      var searchPath = "search.xml";
      if (searchPath.length === 0) {
        searchPath = "search.xml";
      }
      var path = "/" + searchPath;
      searchFunc(path, "search-input", "search-result");
    });
    </script>
    
    
    
    <script defer type="text/javascript" src="https://cdn.staticfile.org/MathJax/MathJax-2.6-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ["$","$"], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ["script", "noscript", "style", "textarea", "pre", "code"]
      }
    });
    </script>
    <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += " has-jax";
      }
    });
    </script>
    
    
    <script defer type="text/javascript" src="/js/index.js"></script>
    <script type="text/javascript">
    $(document).ready(function () {
      var cb = null;
      var els = $(".post figure.highlight");
      if (els.length) {
        // Enabled Hexo highlight line number.
        $(els).each(function (i, e) {
          // $(e).before("<button class=\"copy button\">复制</button>");
          $(e).before([
            "<div class=\"code-titlebar\">",
              "<div class=\"titlebar-left\">",
                "<button class=\"copy\">复制</button>",
              "</div>",
            "</div>"
          ].join(""));
        });
        cb = new ClipboardJS("button.copy", {
          "target": function (trigger) {
              // Get target element by DOM API.
              return trigger.parentNode.parentNode.nextElementSibling.firstChild.firstChild.firstChild.lastChild.firstChild.firstChild;
          }
        });
      } else {
        // Disabled Hexo highlight line number.
        els = $(".post pre code");
        $(els).each(function (i, e) {
          // Add button before pre, not code.
          // $(e).parent().before("<button class=\"copy button\">复制</button>");
          $(e).before([
            "<div class=\"code-titlebar\">",
              "<div class=\"titlebar-left\">",
                "<button class=\"copy\" >复制</button>",
              "</div>",
              "<div class=\"titlebar-right\">",
                "<button class=\"button-dot dot-minimize\" aria-label=\"Decoration\"></button>",
                "<button class=\"button-dot dot-maximize\" aria-label=\"Decoration\"></button>",
                "<button class=\"button-dot dot-close\" aria-label=\"Decoration\"></button>",
              "</div>",
            "</div>"
          ].join(""));
        });
        cb = new ClipboardJS("button.copy", {
          "target": function (trigger) {
              // Get target element by DOM API.
              return trigger.parentNode.parentNode.nextElementSibling;
          }
        });
      }
      cb.on("success", function (e) {
        e.clearSelection();
        var trigger = e.trigger;
        // Change button text as a user tip.
        trigger.innerHTML = "已复制";
        $(trigger).addClass("copied");
        // Change button text back;
        setTimeout(function () {
          trigger.innerHTML = "复制";
          $(trigger).removeClass("copied");
        }, 1500);
      });
    });
    </script>
    
    <script defer type="text/javascript" src="/js/custom.js"></script>
    <title>leinlin的小笔记</title>
  <meta name="generator" content="Hexo 6.2.0"></head>
  <body itemscope itemtype="http://schema.org/WebPage" lang="zh_CN"  data-spy="scroll" data-target=".list-group">
    
<header id="header" class="header" style="background: #33363b;">
  <div class="container">
    <div class="header-container">
      <div class="header-title">
        <h1 class="title"><a href="/">leinlin的小笔记</a></h1>
        <h2 class="subtitle"></h2>
      </div>
      
    </div>
    <nav id="nav" class="nav">
      <a id="nav-toggle" class="nav-toggle" aria-hidden="true"><i class="fas fa-bars" aria-label="切换导航栏"></i></a>
      <ul id="menu" role="menubar" aria-hidden="false">
        
        <li role="menuitem"><a href="/"><i class="fas fa-home"></i><span class="menu-text">首页</span></a></li>
        
        <li role="menuitem"><a href="/categories/"><i class="fas fa-th-list"></i><span class="menu-text">分类</span></a></li>
        
      </ul>
    </nav>
  </div>
</header>


    <main id="main" class="main">
      <div class="container">
        <div class="main-container">
          <div class="content">
            

<div id="index" class="index page">
  
  <article class="article post card animate" itemscope itemtype="http://schema.org/Article">
    <div class="post-block">
      <link itemprop="mainEntityOfPage" href="http://leinlin.github.io/2022/07/09/HDRPartist/TA%E5%B7%A5%E4%BD%9C%E5%86%85%E5%AE%B9/">
      <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
        <meta itemprop="name" content="leinlin">
        <meta itemprop="description" content="">
        <meta itemprop="image" content="/images/avatar.jpg">
      </span>
      <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
        <meta itemprop="name" content="leinlin的小笔记">
      </span>
    </div>
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link post-title-link-external" href="/2022/07/09/HDRPartist/TA%E5%B7%A5%E4%BD%9C%E5%86%85%E5%AE%B9/" itemprop="url">TA工作内容</a>
      </h1>
      <div class="post-meta">
        
        <span class="post-date">
          <i class="far fa-calendar-plus"></i><span><time title="post-date" itemprop="dateCreated datePublished" datetime="2022-07-09T12:00:14+08:00">2022-07-09 12:00:14</time></span>
        </span>
        
        
        
        <span class="post-meta-divider divider">|</span>
        
        <span class="post-categories">
          
          <i class="far fa-folder-open"></i><span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/HDRPartist/" itemprop="url" rel="index"><span itemprop="name">HDRPartist</span></a></span>
        </span>
        
        
        
        
      </div>
    </header>
    <main class="post-main" itemprop="articleBody">
      
      <h2 id="算法性能优化："><a href="#算法性能优化：" class="headerlink" title="算法性能优化："></a>算法性能优化：</h2><ul>
<li>BRDF 计算优化： GGX : F \Geometry\NDF\IBL等。(手游上比较重要)</li>
<li>Texture Atlasing 工具：PBR贴图Pack在一起，合成一个大的贴图，Shader种类必须特别小。</li>
<li>IBL cubemap Normalization：看一下战神的PBR（主要改进的是效果）</li>
</ul>
<h2 id="生产力优化："><a href="#生产力优化：" class="headerlink" title="生产力优化："></a>生产力优化：</h2><ul>
<li>Light probe 自动摆放工具：能走区域(Nav Mesh)，贪心，光照变化。</li>
<li>Texture Streaming工具：Unity内置支持一些功能。</li>
<li>GPU LightMapper&#x2F; Enlighten 动态设置工具。</li>
<li>程序化生成工具，地形生成、物体摆放、模型生成。</li>
<li>资源管理工具。</li>
</ul>
<h2 id="标准制定："><a href="#标准制定：" class="headerlink" title="标准制定："></a>标准制定：</h2><ul>
<li>文档+培训。</li>
<li>所见即所得的工具：帮助美术更好的理解PBR制作的结果，查看工具。</li>
<li>多个版本的标准光照环境：确认资产和灯光得到正确结果：场景，亮度适中、光源没有色彩倾向、没有强烈明暗对比。为了很好的辨识固有色、色相、光滑度、法线、金属度、AO。只用ACES：不用曝光和其他后处理（就是白平衡场景）。</li>
<li>灯光的强度参考：各种常见的光强范围、自动曝光设置方式。</li>
<li>把工具嵌入在流程当中。</li>
<li>定制的SP环境：定制Shader和定制后处理。</li>
</ul>
<h2 id="Shader相关："><a href="#Shader相关：" class="headerlink" title="Shader相关："></a>Shader相关：</h2><ul>
<li>Shader Strip 工具。</li>
<li>Shader 变体控制。</li>
<li>Shader Warmup</li>
<li>Shader Feature</li>
</ul>
<h2 id="TA工作内容分类"><a href="#TA工作内容分类" class="headerlink" title="TA工作内容分类"></a>TA工作内容分类</h2><p>程序化生成：包括地形、材质、贴图、模型、特效的程序化建模。</p>
<p>渲染：效果实现，熟悉渲染管线、熟悉shader、熟悉GPU、BRDF等。</p>
<p>动作：骨骼、动画、蒙皮、IK。</p>
<p>优化：GPU架构、模型面熟、烘焙、资源管理、profile。</p>
<p>工具开发：DCC工具开发，资源管理工具、debug工具，资源检查工具。提升美术工作效率，完善生产工作流。</p>

      
      <p align="right"><a class="morebtn" href="/2022/07/09/HDRPartist/TA%E5%B7%A5%E4%BD%9C%E5%86%85%E5%AE%B9/" title="TA工作内容">阅读全文</a></p>
    </main>
    <footer class="post-footer">
      
    </footer>
  </article>
  
  <article class="article post card animate" itemscope itemtype="http://schema.org/Article">
    <div class="post-block">
      <link itemprop="mainEntityOfPage" href="http://leinlin.github.io/2022/07/09/HDRPartist/%E5%9C%BA%E6%99%AF%E5%8F%8D%E5%B0%84%E7%AD%96%E7%95%A5/">
      <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
        <meta itemprop="name" content="leinlin">
        <meta itemprop="description" content="">
        <meta itemprop="image" content="/images/avatar.jpg">
      </span>
      <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
        <meta itemprop="name" content="leinlin的小笔记">
      </span>
    </div>
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link post-title-link-external" href="/2022/07/09/HDRPartist/%E5%9C%BA%E6%99%AF%E5%8F%8D%E5%B0%84%E7%AD%96%E7%95%A5/" itemprop="url">场景反射策略</a>
      </h1>
      <div class="post-meta">
        
        <span class="post-date">
          <i class="far fa-calendar-plus"></i><span><time title="post-date" itemprop="dateCreated datePublished" datetime="2022-07-09T12:00:14+08:00">2022-07-09 12:00:14</time></span>
        </span>
        
        
        
        <span class="post-meta-divider divider">|</span>
        
        <span class="post-categories">
          
          <i class="far fa-folder-open"></i><span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/GameAnalysis/" itemprop="url" rel="index"><span itemprop="name">GameAnalysis</span></a></span>
        </span>
        
        
        
        
      </div>
    </header>
    <main class="post-main" itemprop="articleBody">
      
      <h1 id="场景反射策略"><a href="#场景反射策略" class="headerlink" title="场景反射策略"></a>场景反射策略</h1><p>目前，Unity已有的反射功能：</p>
<ul>
<li>屏幕空间反射：SSR</li>
<li>平面反射：Planar Reflection Prob</li>
<li>反射探针：Reflection Probe</li>
</ul>
<h2 id="反射功能基本使用"><a href="#反射功能基本使用" class="headerlink" title="反射功能基本使用"></a>反射功能基本使用</h2><h3 id="反射功能的具体调节位置"><a href="#反射功能的具体调节位置" class="headerlink" title="反射功能的具体调节位置"></a>反射功能的具体调节位置</h3><p>在RenderPipelineAsset设置当中 ：LIghting -&gt; Reflections，可以设置反射贴图分辨率等内容。</p>
<h3 id="SSR"><a href="#SSR" class="headerlink" title="SSR"></a>SSR</h3><p>由于默认的HDRP工程没有开启SSR，所以需要开启SSR：</p>
<p>在RenderPipelineAsset设置当中 ：LIghting -&gt; Reflections：勾选Screen Space Reflection。</p>
<p><img src="/../../images/img/11.jpg" alt="11"></p>
<p>在RenderPipelineAsset设置当中 ：Default Frame Settings -&gt; Lighting：勾选SSR。</p>
<p>如果这个选项打开场景中有可能会始终存在SSR，不需要SSR的物体要关闭材质上的Receive SSR开关。</p>
<p>在要接收SSR的Lit材质球上或者Shader Graph上开启，Receive SSR：</p>
<p><img src="/../../images/img/13.jpg" alt="13"></p>
<p>在Post Volume中添加SSR：</p>
<p><img src="/../../images/img/14.jpg" alt="14"></p>
<p>SSR效果如下：</p>
<p><img src="/../../images/img/15.jpg" alt="15"></p>
<h3 id="平面反射探针"><a href="#平面反射探针" class="headerlink" title="平面反射探针"></a>平面反射探针</h3><p>在Hierachy当中右键 -&gt;Light -&gt; Planar Reflecition Probe创建一个平面反射探针。</p>
<p><img src="/../../images/img/8.jpg" alt="8"></p>
<p>通过调整平面的位置和平面的角度（<strong>最上方的右边两个按钮</strong>），可以影响反射的内容。</p>
<p>修改<strong>Influence Volume</strong>可以调整反射内容影响的物体。</p>
<p>平面反射效果：</p>
<p><img src="/../../images/img/9.jpg" alt="9"></p>
<p>Influence Volume：</p>
<p><img src="/../../images/img/10.jpg" alt="10"></p>
<h3 id="反射探针"><a href="#反射探针" class="headerlink" title="反射探针"></a>反射探针</h3><p>在Hierachy当中右键 -&gt;Light -&gt; Reflecition Probe创建一个反射探针。</p>
<p><img src="/../../images/img/1.jpg" alt="1"></p>
<p>打开Window-&gt;Rendering-&gt;Lighting Settings 设置。关闭右下角Aoto Generate。</p>
<p><img src="/../../images/img/2.jpg" alt="2"></p>
<p>此时把Reflection Probe 的Type改成 Baked，最下方就会出现Bake按钮，如下图。</p>
<p><img src="/../../images/img/3.jpg" alt="3"></p>
<p>根据需求修改上图参数，之后点击bake就会生成对应的探针。探针会影响所有在<strong>Influence Volume</strong>当中的物体。反射效果如下图所示。</p>
<p><img src="/../../images/img/4.jpg" alt="4"></p>
<p>Influence Volume如下图所示：</p>
<p><img src="/../../images/img/5.jpg" alt="5"></p>
<p>同时，反射的内容是根据Base Shape决定的：下图是不同的base Shape对应的不同反射效果。</p>
<p><img src="/../../images/img/6.jpg" alt="6"></p>
<p><img src="/../../images/img/7.jpg" alt="7"></p>
<h2 id="反射策略"><a href="#反射策略" class="headerlink" title="反射策略"></a>反射策略</h2><h3 id="SSR的使用场景"><a href="#SSR的使用场景" class="headerlink" title="SSR的使用场景"></a>SSR的使用场景</h3><p>使用场景：</p>
<p>​	屏幕空间反射通常应用于需要和场景对齐的反射面，例如：冰面、湖面。同时可以应用在凹凸不平的地面。</p>
<p>下面是常见问题和解决方案。</p>
<h4 id="1-像素丢失"><a href="#1-像素丢失" class="headerlink" title="1. 像素丢失"></a>1. 像素丢失</h4><p>SSR最常见的问题就是像素丢失。如果在纵深方向，场景过于复杂，SSR的效果就会很差。如下图所示，红色框内部就是因为场景前方的木棒，导致后方的墙无法反射出来：</p>
<p><img src="/../../images/img/20.jpg" alt="20"></p>
<p>解决方法是可以增加Max Number of Ray Steps。但是会导致性能变差。</p>
<p>同时要避免在这样的场景当中使用SSR。</p>
<h4 id="2-屏幕缺角"><a href="#2-屏幕缺角" class="headerlink" title="2. 屏幕缺角"></a>2. 屏幕缺角</h4><p>SSR第二个缺陷就是缺角，屏幕的左右下角会根据视线角度发生一定程度的丢失，如下图，可以调节Screen Edge Fade Distance 来让边界不这么明显。</p>
<p><img src="/../../images/img/21.jpg" alt="21"></p>
<h4 id="3-平滑表面反射"><a href="#3-平滑表面反射" class="headerlink" title="3. 平滑表面反射"></a>3. 平滑表面反射</h4><p>SSR第三个问题就是不适合纯平表面。如果物体表面非常平滑（没有法线扰动），会导致SSR效果不够自然。</p>
<p>通常使用SSR的表面都会添加法线扰动。如下图所示，下面的反射看起来效果自然很多，错误并不明显，并且性能也能够保证：</p>
<p><img src="/../../images/img/22.jpg" alt="22"></p>
<h4 id="4-参数根据场景变动"><a href="#4-参数根据场景变动" class="headerlink" title="4. 参数根据场景变动"></a>4. 参数根据场景变动</h4><p>由于不同的参数适应不同的场景，所以最好不同的位置使用不同的Volume 来控制SSR的参数。</p>
<h3 id="反射探针使用场景"><a href="#反射探针使用场景" class="headerlink" title="反射探针使用场景"></a>反射探针使用场景</h3><h4 id="1-反射探针常用场景"><a href="#1-反射探针常用场景" class="headerlink" title="1. 反射探针常用场景"></a>1. 反射探针常用场景</h4><p>所有的不需要和场景对齐的物体建议都使用反射探针，同时需要关闭接受SSR，如下图：</p>
<p><img src="/../../images/img/25.jpg" alt="25"></p>
<p>通常反射探针的开销比ssr小。如果同时存在，反射探针会覆盖SSR。他们的边界会出现不自然的过度。</p>
<h4 id="2-使用反射探针的特殊场景"><a href="#2-使用反射探针的特殊场景" class="headerlink" title="2. 使用反射探针的特殊场景"></a>2. 使用反射探针的特殊场景</h4><p>对于垂直的小墙面，正方形的房子，反射探针也能够得到很好的效果。</p>
<p>如果要得到足够好的反射效果，需要合理的调整反射探针的内容和位置。</p>
<p>下面是反射探针的效果：</p>
<p><img src="/../../images/img/23.jpg" alt="23"></p>
<p>只要反射探针的volume能够和墙面对齐，就能够得到基本正确的结果，但是反射探针也有自己的问题，如下图，位置完全偏离：</p>
<p><img src="/../../images/img/24.jpg" alt="24"></p>
<p>所以，通常反射探针用在反射效果不需要和场景完全对齐的物体上，例如：非常光滑的金属部件，水坑，眼球。</p>
<h4 id="3-没有正确的设置反射探针"><a href="#3-没有正确的设置反射探针" class="headerlink" title="3. 没有正确的设置反射探针"></a>3. 没有正确的设置反射探针</h4><p>​	如果没有正确的放置反射探针，会导致物体的反射效果和场景不融，尤其是金属物体。会造成光照很突兀。</p>
<h3 id="平面反射使用场景"><a href="#平面反射使用场景" class="headerlink" title="平面反射使用场景"></a>平面反射使用场景</h3><p>平面反射探针可以应付所有的平面镜面反射，但是开销极高，除非在特别简单的场景，否则不建议使用。</p>

      
      <p align="right"><a class="morebtn" href="/2022/07/09/HDRPartist/%E5%9C%BA%E6%99%AF%E5%8F%8D%E5%B0%84%E7%AD%96%E7%95%A5/" title="场景反射策略">阅读全文</a></p>
    </main>
    <footer class="post-footer">
      
    </footer>
  </article>
  
  <article class="article post card animate" itemscope itemtype="http://schema.org/Article">
    <div class="post-block">
      <link itemprop="mainEntityOfPage" href="http://leinlin.github.io/2022/07/09/HDRPartist/%E5%9C%BA%E6%99%AF%E7%BE%8E%E6%9C%AF%E8%B5%84%E6%BA%90%E4%BC%98%E5%8C%96%E6%80%9D%E8%B7%AF/">
      <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
        <meta itemprop="name" content="leinlin">
        <meta itemprop="description" content="">
        <meta itemprop="image" content="/images/avatar.jpg">
      </span>
      <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
        <meta itemprop="name" content="leinlin的小笔记">
      </span>
    </div>
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link post-title-link-external" href="/2022/07/09/HDRPartist/%E5%9C%BA%E6%99%AF%E7%BE%8E%E6%9C%AF%E8%B5%84%E6%BA%90%E4%BC%98%E5%8C%96%E6%80%9D%E8%B7%AF/" itemprop="url">美术资源优化思路与原理</a>
      </h1>
      <div class="post-meta">
        
        <span class="post-date">
          <i class="far fa-calendar-plus"></i><span><time title="post-date" itemprop="dateCreated datePublished" datetime="2022-07-09T12:00:14+08:00">2022-07-09 12:00:14</time></span>
        </span>
        
        
        
        <span class="post-meta-divider divider">|</span>
        
        <span class="post-categories">
          
          <i class="far fa-folder-open"></i><span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/HDRPartist/" itemprop="url" rel="index"><span itemprop="name">HDRPartist</span></a></span>
        </span>
        
        
        
        
      </div>
    </header>
    <main class="post-main" itemprop="articleBody">
      
      <h1 id="美术资源优化思路与原理"><a href="#美术资源优化思路与原理" class="headerlink" title="美术资源优化思路与原理"></a>美术资源优化思路与原理</h1><h2 id="美术资源可能带来的性能问题"><a href="#美术资源可能带来的性能问题" class="headerlink" title="美术资源可能带来的性能问题"></a>美术资源可能带来的性能问题</h2><ol>
<li><p>游戏内存： 场景当中要绘制的所有东西都需要保存到内存中，其中最重要的就是：<strong>模型、贴图</strong>。</p>
</li>
<li><p>drawcall：每绘制一种东西（不同的模型：即使是相同的材质球也算不同的模型，除非合并他们的mesh），<strong>内存都需要把相关的渲染参数、模型数据、贴图数据传递到GPU</strong>，这个速度非常慢，所以看到的模型越多，drawcall越多。</p>
</li>
<li><p>GPU渲染速度：模型的材质越复杂，渲染越慢。这个靠TA来制定标准即可。</p>
</li>
</ol>
<p>美术制作资源是需要关注前两点。</p>
<h2 id="场景美术资源优化策略"><a href="#场景美术资源优化策略" class="headerlink" title="场景美术资源优化策略"></a>场景美术资源优化策略</h2><p>场景美术资源优化主要有个以下方面：</p>
<ol>
<li><p>模型拆分，模型组件复用：美术制作场景时，复用模型资源进行摆放。<strong>只是为了提升工作效率，拆分之后还是需要尽可能使用相同材质，最终还是要合并。</strong></p>
</li>
<li><p>贴图Tiling，贴图复用：能够直接降低内存开销。<strong>为了效果可以使用更少、分辨率更高的贴图。</strong></p>
</li>
<li><p>材质复用：不同的模型使用同一个材质球（必须是同一个材质球，而不是不同的材质球同一个参数。）<strong>材质复用的目的，是最终要合并网格以减少drawcall，如果不合并那么材质复用就没有意义。</strong> <strong>Dynamic Batch</strong> 就是这个原理，但是他会在内存生成一份合并后的mesh，相当于内存占用翻倍，浪费内存。<strong>Static Batch</strong>也是一样，只不过是静态合并好。但是合并的物体覆盖全场景。还会导致遮挡剔除失效，同样占内存。</p>
</li>
<li><p>Prefab复用（包括组件的Prefab，完整模型的Prefab）：直接提升资源利用率。这种服用就是一模一样的mesh和材质，可以直接合并。</p>
</li>
</ol>
<h3 id="游戏性能瓶颈：模型"><a href="#游戏性能瓶颈：模型" class="headerlink" title="游戏性能瓶颈：模型"></a>游戏性能瓶颈：模型</h3><p>由于场景资源复杂，可能遇到的性能瓶颈：</p>
<ol>
<li><p>模型数量：模型数量越多（ 一个submesh算一个模型 ）drawcall越多，成正比。</p>
</li>
<li><p>一个模型的面数：模型越大，越占内存。（不使用static batch的原因）。</p>
</li>
<li><p>模型属性太多（比如各个uv通道全部使用，normal、tangent全部使用）：属性使用的越多，越占内存。</p>
</li>
</ol>
<p><strong>模型的内存开销&#x3D;模型数量 * 一个模型的面数 * 模型属性</strong></p>
<p><strong>模型的drawcall 开销&#x3D; 场景中的模型数量。</strong></p>
<h3 id="游戏性能优化：模型"><a href="#游戏性能优化：模型" class="headerlink" title="游戏性能优化：模型"></a>游戏性能优化：模型</h3><ol>
<li><p>美术在3Dmax当中合并不同的mesh。（相同材质的合并，通过合理分布uv可以让大部分mesh复用同一个材质）。<strong>能够在模型总内存消耗不变的情况下降低drawcall。</strong></p>
</li>
<li><p>如果材质的属性不使用，就不要输出，例如：第二套uv，顶点色，切线信息。<strong>直接降低内存开销。</strong></p>
</li>
<li><p>控制模型面数，场景当中看不到的面裁切掉。<strong>直接降低内存开销。</strong></p>
</li>
</ol>
<h3 id="游戏性能瓶颈：贴图"><a href="#游戏性能瓶颈：贴图" class="headerlink" title="游戏性能瓶颈：贴图"></a>游戏性能瓶颈：贴图</h3><ol>
<li><p><strong>场景中涉及到的</strong>贴图数量越多，内存占用越大。（例如：一张1024*1024的三通道贴图，相当于一个100万点的只记录了顶点位置的模型，相当于10万顶点并记录了顶点色的模型），美术需要考虑模型和贴图之间的平衡。</p>
</li>
<li><p><strong>场景中涉及到的</strong>贴图越大，内存占用越多。</p>
</li>
<li><p><strong>场景中涉及到的</strong>贴图开启mipmap占用内存越多。</p>
</li>
<li><p>如果贴图不在场景中，那他就只是占用内存而已。</p>
</li>
</ol>
<p><strong>贴图内存开销&#x3D; 贴图数量 * 贴图大小。</strong></p>
<p><strong>贴图drawcall开销 &#x3D; 基本只和内存有关。</strong></p>
<p>*<strong>注：</strong>“场景当中涉及到的”指的是客户端从硬盘加载到内存的场景数据。</p>
<h3 id="游戏性能优化：贴图"><a href="#游戏性能优化：贴图" class="headerlink" title="游戏性能优化：贴图"></a>游戏性能优化：贴图</h3><p><strong>贴图内存开销&#x3D; 贴图数量 * 贴图大小。</strong></p>
<ol>
<li><p>使用Tiling方式的贴图。<strong>减小贴图大小。</strong></p>
</li>
<li><p>提高利用率。<strong>减少贴图数量。</strong></p>
</li>
</ol>
<h3 id="游戏性能瓶颈：材质"><a href="#游戏性能瓶颈：材质" class="headerlink" title="游戏性能瓶颈：材质"></a>游戏性能瓶颈：材质</h3><ol>
<li><p><strong>场景中涉及到的材质</strong>数量越多drawcall越多。</p>
</li>
<li><p><strong>场景中涉及到的材质</strong>使用的贴图越多占用内存越多。</p>
</li>
</ol>
<p>材质内存开销 &#x3D;  几乎不考虑。</p>
<p>材质drawcall开销&#x3D; 主要看mesh，因为如果同一个mesh 使用不同的材质，那么drawcall还是两个。</p>
<p><strong>材质复用的真正目的是为了能够合并场景中使用相同材质的mesh。以直接减少drawcall。</strong></p>
<h3 id="游戏性能优化：材质"><a href="#游戏性能优化：材质" class="headerlink" title="游戏性能优化：材质"></a>游戏性能优化：材质</h3><p><strong>材质复用的真正目的：为了能够合并场景中使用相同材质的mesh，以直接减少drawcall。</strong></p>
<ol>
<li><p><strong>使用相同的材质 + 不同的mesh</strong> 的策略来实现丰富的表现，方便合并。例如：用刷顶点色，代替mask贴图。</p>
</li>
<li><p>材质复用优先于mesh复用：如果mesh复用，而使用了不同的材质，那么drawcall不能再减少了。如果复用了材质（同一个材质球），而使用了不同的mesh，那么有很多方法来合并mesh以减少drawcall。</p>
</li>
</ol>

      
      <p align="right"><a class="morebtn" href="/2022/07/09/HDRPartist/%E5%9C%BA%E6%99%AF%E7%BE%8E%E6%9C%AF%E8%B5%84%E6%BA%90%E4%BC%98%E5%8C%96%E6%80%9D%E8%B7%AF/" title="美术资源优化思路与原理">阅读全文</a></p>
    </main>
    <footer class="post-footer">
      
    </footer>
  </article>
  
  <article class="article post card animate" itemscope itemtype="http://schema.org/Article">
    <div class="post-block">
      <link itemprop="mainEntityOfPage" href="http://leinlin.github.io/2022/07/09/HDRPartist/%E6%B3%95%E7%BA%BF%E8%B4%B4%E5%9B%BE%E6%97%8B%E8%BD%AC/">
      <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
        <meta itemprop="name" content="leinlin">
        <meta itemprop="description" content="">
        <meta itemprop="image" content="/images/avatar.jpg">
      </span>
      <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
        <meta itemprop="name" content="leinlin的小笔记">
      </span>
    </div>
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link post-title-link-external" href="/2022/07/09/HDRPartist/%E6%B3%95%E7%BA%BF%E8%B4%B4%E5%9B%BE%E6%97%8B%E8%BD%AC/" itemprop="url">法线贴图旋转</a>
      </h1>
      <div class="post-meta">
        
        <span class="post-date">
          <i class="far fa-calendar-plus"></i><span><time title="post-date" itemprop="dateCreated datePublished" datetime="2022-07-09T12:00:14+08:00">2022-07-09 12:00:14</time></span>
        </span>
        
        
        
        <span class="post-meta-divider divider">|</span>
        
        <span class="post-categories">
          
          <i class="far fa-folder-open"></i><span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/HDRPartist/" itemprop="url" rel="index"><span itemprop="name">HDRPartist</span></a></span>
        </span>
        
        
        
        
      </div>
    </header>
    <main class="post-main" itemprop="articleBody">
      
      <h1 id="法线贴图旋转"><a href="#法线贴图旋转" class="headerlink" title="法线贴图旋转"></a>法线贴图旋转</h1><p>在场景材质制作过程中，可能会大量的使用tiling材质球。</p>
<p>有时候tiling材质的走向和想要的走向不同，可能希望可以对贴图进行旋转。</p>
<p>对于其他颜色贴图来说旋转没有什么影响。</p>
<p>但是，对于法线贴图来说，<strong>旋转法线贴图就会造成错误。</strong></p>
<p>下图是正确的法线贴图：</p>
<p><img src="/../../images/img/original.jpg" alt="original"></p>
<p>在法线贴图中，<strong>法线的朝向是切线空间中的方向</strong>，并且xy通道中的颜色从[-1,1]归一化到了[0,1]，所以默认法线方向为(0.5, 0.5, 1)<strong>，同时：在切线空间中，向下的方向是紫色，向右是蓝色，向左是粉色，向上是青色</strong>。</p>
<p>法线贴图颜色表示的是在切线空间的方向，也就是uv贴图中的朝向。例如，<strong>粉色表示切线空间中，法线偏向左侧，也就是u减小的方向。</strong></p>
<p>如果对法线贴图直接进行旋转，就会得到错误的法线贴图：</p>
<p><img src="/../../images/img/wrong.jpg" alt="wrong"></p>
<p>仔细观察发现，图形的下边界变成了粉色，表示下边界指向左侧。这个时候图形的边界方向不在向内偏，也就是说他不再是凹的了。这就是法线错误的原因。</p>
<h2 id="解决方式"><a href="#解决方式" class="headerlink" title="解决方式"></a>解决方式</h2><p>为了能够让法线贴图进行旋转，需要对其进行特殊的处理。</p>
<p>只要将法线方向连同贴图一起旋转即可。</p>
<p>法线方向的旋转方式就是，让法线绕向量(0,0,1)与贴图旋转相同的角度即可。</p>

      
      <p align="right"><a class="morebtn" href="/2022/07/09/HDRPartist/%E6%B3%95%E7%BA%BF%E8%B4%B4%E5%9B%BE%E6%97%8B%E8%BD%AC/" title="法线贴图旋转">阅读全文</a></p>
    </main>
    <footer class="post-footer">
      
    </footer>
  </article>
  
  <article class="article post card animate" itemscope itemtype="http://schema.org/Article">
    <div class="post-block">
      <link itemprop="mainEntityOfPage" href="http://leinlin.github.io/2022/07/09/Paper/ClusterShadows/">
      <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
        <meta itemprop="name" content="leinlin">
        <meta itemprop="description" content="">
        <meta itemprop="image" content="/images/avatar.jpg">
      </span>
      <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
        <meta itemprop="name" content="leinlin的小笔记">
      </span>
    </div>
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link post-title-link-external" href="/2022/07/09/Paper/ClusterShadows/" itemprop="url">More Efﬁcient Virtual Shadow Maps for Many Lights</a>
      </h1>
      <div class="post-meta">
        
        <span class="post-date">
          <i class="far fa-calendar-plus"></i><span><time title="post-date" itemprop="dateCreated datePublished" datetime="2022-07-09T12:00:14+08:00">2022-07-09 12:00:14</time></span>
        </span>
        
        
        
        <span class="post-meta-divider divider">|</span>
        
        <span class="post-categories">
          
          <i class="far fa-folder-open"></i><span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/HDRPSource/" itemprop="url" rel="index"><span itemprop="name">HDRPSource</span></a></span>
        </span>
        
        
        
        
      </div>
    </header>
    <main class="post-main" itemprop="articleBody">
      
      <h1 id="More-Efﬁcient-Virtual-Shadow-Maps-for-Many-Lights"><a href="#More-Efﬁcient-Virtual-Shadow-Maps-for-Many-Lights" class="headerlink" title="More Efﬁcient Virtual Shadow Maps for Many Lights"></a>More Efﬁcient Virtual Shadow Maps for Many Lights</h1><h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>这个方法主要用来解决大量灯光的实时阴影。</p>
<p>主要的方法是：</p>
<ol>
<li><p>硬件支持的virtual cube-map shadows, 来高效的实现数百个光源的实时阴影。</p>
</li>
<li><p>我们探讨了光线追踪对多光源阴影的效用，并提出了一种结合光线追踪与virtual cube-map的混合算法。</p>
</li>
</ol>
<p>主要优点：支持数百盏光源的高细节动态阴影。</p>
<p>​	目前有很多技术支持上百盏实时灯光。这些技术把灯光划分到不同的屏幕tile当中。这样可以让Shader同时的访问多盏灯光，提高艺术创作的自由度。</p>
<p>​	但是这些技术大部分是不计算阴影的，虽然有了更多的灯管细节和动态效果，但是没有阴影导致丢失了很多几何细节，画面看起来很平，没有立体感。</p>
<p>没有了阴影，会导致漏光。</p>
<p>​	本文记得数就是捕获阴影的灯管，支持上百盏同时投射阴影的灯光。这些阴影是高和统一的质量，同时保持在一个有限的内存占用范围内。</p>
<h2 id="主要贡献"><a href="#主要贡献" class="headerlink" title="主要贡献"></a>主要贡献</h2><ol>
<li><p>本文的主要贡献就是提出<strong>一个高效的基于tile的culling方式把投射阴影的物体渲染得到不同的cube shadow map中。</strong></p>
</li>
<li><p>对于静态灯光和静态几何体也是一样的，我们也会展示，如何利用这些信息，通过在帧之间保留部分阴影映射，进一步提高剔除效率和性能。</p>
</li>
<li><p>提出了一种快速估计每盏灯光ShadowMap分辨率</p>
</li>
<li><p>为了支持有效的内存管理，我们演示了如何利用硬件支持的虚拟阴影映射来只存储相关的阴影映射示例。为此，我们引入了一种有效的方法来确定每个虚拟阴影图中需要物理支持的部分。</p>
</li>
<li><p>我们探索了多盏灯光的raytracing性能，验证了一个混合了tray tracing和cubmap的方式，来提供shadowmap，这种方式比单独的始终各自的方法性能都更优。</p>
</li>
<li><p>我们提供了技术的细节和详细的算法测评，正面我们所提出的方法的确能够提供大量光源的实时高性能阴影。</p>
</li>
</ol>
<h2 id="前期工作"><a href="#前期工作" class="headerlink" title="前期工作"></a>前期工作</h2><p>相关算法的内容。</p>
<p>RealTime Many Light Shading： 各种着色技术，其中最重要的就是Tile Shading。</p>
<p>Shadow Algorithms：主要描述各种计算各个光源的阴影的方法。</p>
<p>Virtual Shadow Maps：对于单个光源的应用贴图。</p>
<p>Many light shadows：多光源阴影计算方式。</p>
<p>Ray Trace Shadow：</p>
<h2 id="回顾一下我们要解决的问题"><a href="#回顾一下我们要解决的问题" class="headerlink" title="回顾一下我们要解决的问题"></a>回顾一下我们要解决的问题</h2><p>​	我们只研究全方位点光源，有限的照亮范围，在边界亮度衰减到0。</p>
<p>​	这是一种普遍的灯光模型，易于控制影响屏幕的那些部分。也就是易于控制灯光的性能。其他的灯光模式也可以看做全方位光源（点光源）的一种。</p>
<p>对于实时渲染来使用的基本是经典的Shadow-Map（SM），或者他的变体。这种算法的普遍使用是有原因的，比如，固	定的采样率，丰富的硬件支持，任意几何体都支持，可以用滤波平滑阴影。所以，我们也使用这种技术。因为使用的是点光源，所以使用ShadowCubemap。</p>
<p>​	要使用多光源你的ShadowMap 需要解决一下的问题：</p>
<ul>
<li><p>决定哪些光源会投射可见的阴影。</p>
</li>
<li><p>决定每个光源ShadowMap的分辨率。</p>
</li>
<li><p>申请Shadow map的内存空间。</p>
</li>
<li><p>把投射阴影的几何体渲染到ShadowMap上。</p>
</li>
<li><p>使用灯光和其对应的Shadow渲染场景。</p>
<p>Clustered Shading技术：为每一个Cluster计算一个灯光列表。不在这个灯光列表当中的灯光，不会在这个Cluster当中投射任何的可见阴影。</p>
</li>
</ul>
<h2 id="基础算法"><a href="#基础算法" class="headerlink" title="基础算法"></a>基础算法</h2><p>我们的基本算法将在下面详细描述。基本算法是从Clustered deferred算法中构造出来的，我们对于阴影计算的扩展，用粗体标注：</p>
<ol>
<li>把场景渲染到Gbuffer。</li>
<li>Cluster的划分，根据当前的View，把场景划分成Cluster。</li>
<li>计算唯一的Cluster，计算紧凑的一个Cluster列表。</li>
<li>把灯光分配到各个Cluster当中。</li>
<li><strong>为每个灯选择Shadowmap渲染分辨率。</strong></li>
<li><strong>申请ShadowMap空间</strong></li>
<li><strong>Culling几何体。</strong></li>
<li><strong>光栅化ShadowCubeMap。</strong></li>
<li>着色。</li>
</ol>
<h3 id="Cluster-Shading简介"><a href="#Cluster-Shading简介" class="headerlink" title="Cluster Shading简介"></a>Cluster Shading简介</h3><p>在Cluster-Shading当中，View-Volume会被划分成一个三维的网格，屏幕上的2D网格是平均划分的，例如一个Tiles占据32*32个像素。 而深度方向上，根据深度逐渐增加网格的划分密度增加。</p>
<p>然后判断哪个Cluster中有可见的几何体，后面的计算只针对有内容的Cluster。然后再把灯光划分到这些cluster当中。</p>
<p>最后我们就产生了一组Cluster和灯光的配对信息。</p>
<p><img src="/../../images/ClusterShadows/1600660002764.png" alt="1600660002764"></p>
<p>上图中可以看出，C0到C3表示有几何体的Cluster。计算只会针对这些几何体，然后记录灯光L0和L1影响那些Cluster。最后就得到了C1-L0、C2_L0、C2-L1 ….这些Light-Cluster对。</p>
<p>灯光计算时，每个可见的sample（屏幕像素）通过查看其与所在Cluster有联系的灯，并总结它们的贡献（brdf和shadow）来着色。</p>
<p>这个过程产生的关键信息是：</p>
<ol>
<li>一组已占用的Cluster。</li>
<li>边界(用于估计几何体是否在内部)</li>
<li>每个Cluster有关的光集：<strong>Cluster-Light对。</strong></li>
</ol>
<p>这些信息将用于阴影计算.</p>
<h3 id="阴影分辨率动态计算"><a href="#阴影分辨率动态计算" class="headerlink" title="阴影分辨率动态计算"></a>阴影分辨率动态计算</h3><p>计算一个灯光阴影贴图分辨率的简单方式，就是计算灯光bouding-sphere的屏幕覆盖面积。这个方法的优点是速度快，但是不够准确。</p>
<p>还有一个方法是RMSM。这个方法是昂贵的，因为必须为每一个像素计算所需要的分辨率，保证每一个像素在阴影贴图中都有足够的精度。我们不需要这么准确的计算，所以文中使用的方法是计算每一个Cluster在一个Light的ShadowMap当中需要的精度，然后选择一个最低需要满足的标准，作为最终精度。</p>
<p>我们根据每一个Cluster的bounding-box进行计算。</p>
<p>假设我们需要的ShadowCubeMapd的分辨率是R。根据单位圆的固体角比例、占屏幕像素的大小进行估计：</p>
<p>$$ R &#x3D; \sqrt{\frac{S&#x2F;\alpha &#x2F; 4 \pi}{6}} $$</p>
<p><strong>每一个Light-Cluster对都会得到一个R，为每一个Light选择一个最大的R，作为ShadowMap的精度。</strong></p>
<p>这个过程产生的关键信息是：</p>
<ol>
<li>每一个Cluster-Light对，都会计算一个阴影分辨率R。</li>
<li>对Light选择一个与其关联的、最大的R。</li>
</ol>
<h3 id="Shadow-Map-Allocation-阴影贴图的空间申请"><a href="#Shadow-Map-Allocation-阴影贴图的空间申请" class="headerlink" title="Shadow Map Allocation 阴影贴图的空间申请"></a>Shadow Map Allocation 阴影贴图的空间申请</h3><p>使用上一步的分辨率计算方式，我们就可以为每一个灯光申请一个非0大小的Shadow Map。这并不是申请实际的物理空间，而是一个虚拟的范围。我们实际上需要使用Virtual Texture技术来管理Shadow Map的物理内存。</p>
<blockquote>
<p>  virtual texture的做法是，把一个巨大的非重复性纹理切割成无数的小page,通过一个indirection texture，通过记录mega texture 的uv offset,把这些page映射到到到这个indirection texture里。</p>
<p>  在Virtual Texture当中，Pages以一个固定大小的覆盖整个Texture。在我们渲染Shadow Map的时候，我们需要提交这些物理内存，然后在渲染时进行采样。</p>
</blockquote>
<p>因为我们需要调页，申请实际的内存，所以我们需要知道阴影贴图的那些位置是需要写入和读取的。我们一般可以逐个像素判断某个page是否需要，但是效率太低。我们使用一个Cluster是否覆盖某个Page的方式计算。只需要把CLuster的AABB投影到ShadowMap的空间上，就可以了，下面是投影算法。</p>
<figure class="hljs highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c">Rect <span class="hljs-title function_">xPlus</span><span class="hljs-params">(Aabb aabb)</span> <br>&#123; 	<br>    <span class="hljs-type">float</span> rdMin = <span class="hljs-number">1.0</span>/max(Epsilon, aabb.min.x); <br>    <span class="hljs-type">float</span> rdMax = <span class="hljs-number">1.0</span>/max(Epsilon, aabb.max.x);<br>	<span class="hljs-type">float</span> sMin = min(-aabb.max.z * rdMin, -aabb.max.z * rdMax); <br>    <span class="hljs-type">float</span> sMax = max(-aabb.min.z * rdMin, 	-aabb.min.z * rdMax);<br>	<span class="hljs-type">float</span> tMin = min(-aabb.max.y * rdMin, -aabb.max.y * rdMax); <br>    <span class="hljs-type">float</span> tMax = max(-aabb.min.y * rdMin, -aabb.min.y * rdMax);<br>	Rect r;<br>	r.min = clamp(float2(sMin, tMin),<span class="hljs-number">-1.0</span>,<span class="hljs-number">1.0</span>); r.max = clamp(float2(sMax, tMax),<span class="hljs-number">-1.0</span>,<span class="hljs-number">1.0</span>);<br>	<span class="hljs-keyword">return</span> r;	<br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="Culling-Shadow-Casting-Geometry"><a href="#Culling-Shadow-Casting-Geometry" class="headerlink" title="Culling Shadow-Casting Geometry"></a>Culling Shadow-Casting Geometry</h3><p>​	剪裁渲染阴影的几何体。剪裁是实时渲染的一个重要的组成部分，把不需要的渲染内容去除掉是提升渲染性能的关键。我们根据几何体是否在Render Volume中来判断是否渲染。这种判断需要通过一个特殊的加速结构体进行优化，常用结构体包括KD-tree、八叉树、BVH。有效的剔除需要视口体积的大小和几何批次之间有一定的相关性。在我们的应用中，可视Volume就是灯光的Bound-Sphere.这个Volume要比正常的Volume要小。因此我们需要更小的三角形渲染集合。我们用bounding volume hierarchy（BVH），来保存不同级别的渲染集合.</p>
<p>​	在这个算法当中View Volume就是灯光的bounding-sphere。这个Volume要比我们的主视口小的多，因此需要更小的Batch。我们使用BVH来保存需要渲染的三角形Batch，每一个batch包括一个AABB。</p>
<blockquote>
<p>  BVH可以理解成一种类似八叉树或者KD-Tree的场景物体保存方式。</p>
</blockquote>
<blockquote>
<p>  这部分的粗略对于场景的划分有很严格的要求，在实际游戏当中不一定用的到。</p>
</blockquote>
<h3 id="光栅化阴影投射的几何体。"><a href="#光栅化阴影投射的几何体。" class="headerlink" title="光栅化阴影投射的几何体。"></a>光栅化阴影投射的几何体。</h3><p>把几何体渲染到ShadowMap上，具体的方法和实现细节相关。</p>
<h3 id="Shading"><a href="#Shading" class="headerlink" title="Shading"></a>Shading</h3><p>Shading过程就是一个full-screen的pass。对于每一个像素点：循环的计算每一个灯光，然后根据灯光的索引找到对应的ShadowCubemap，计算阴影。通常使用Shadow cubemap Array来保存ShadowMap，<strong>但是为了支持不同尺寸的Shado cubeMap组成Array，还需要别的算法。</strong></p>
<h2 id="算法扩展"><a href="#算法扩展" class="headerlink" title="算法扩展"></a>算法扩展</h2><p>前一个章节只是简单介绍了基础的算法。这一章节会把重要的算法进行说明。</p>
<h3 id="Projection-Maps"><a href="#Projection-Maps" class="headerlink" title="Projection Maps"></a>Projection Maps</h3><p>为了改进渲染culling效率，我们应该避免渲染在ShadowMap当中不需要采样的部分。也就是说，我们需要一些信息来确定接受阴影物体（像素）的位置。类似于投影映射：在光子贴图中指引光子的分布。</p>
<p>​	幸运的是，这个和为virtual texture建立page是同样的问题。我们仍然使用把AABB投影到Cube表面的方法。为了表示阴影接收器，每一个cube的表面都是一个32X32bit的Mask。</p>
<p>​	</p>
<h3 id="Non-uniform-Light-Sizes"><a href="#Non-uniform-Light-Sizes" class="headerlink" title="Non-uniform Light Sizes"></a>Non-uniform Light Sizes</h3><p>根据之前的分辨率选择算法。如果过灯光范围过大，在屏幕上不同的额位置上需要的分辨率是不一样的，近处可能是密度过高的，会造成浪费。如果只有统一大小的灯，我们可以直接限制最高的分辨率。然而，正如我们的结果所显示的，如果我们有一个场景有照射范围大小不同的灯光，那么这就会影响内存分配。</p>
<p>为了解决这个问题，我们需要每一个光源申请数量不同的ShadowMap。我们使用一个固定的数字，因为这允许快速和简单的实现，每一个光源可以使用1到16张数量不同的阴影贴图。为了分配阴影贴图，我们添加了一个步骤，在每个光线影响的cluster上，对需求的分辨率建立一个直方图。每个直方图桶内的最大值被用来确认阴影贴图大小。建立阴影贴图索引后，我们用这个索引替换集群光照列表中的光照索引。然后，裁剪和绘制可以保持相同，除了我们有时必须注意分开光索引和阴影贴图索引</p>
<h3 id="Level-of-Detail"><a href="#Level-of-Detail" class="headerlink" title="Level of Detail"></a>Level of Detail</h3><h3 id="Explicit-Cluster-Bounds-确认Cluster的边界"><a href="#Explicit-Cluster-Bounds-确认Cluster的边界" class="headerlink" title="Explicit Cluster Bounds 确认Cluster的边界"></a>Explicit Cluster Bounds 确认Cluster的边界</h3><p>每一个Cluster都是 一个在视锥体当中的一个格子，每一个位置都有一个Bounding Volume.计算显式边界，来紧密拟合集群内的样本，Bounding Volume计算准确但是也会造成额外的开销。</p>
<p>因此，我们提出了一种新的设计，在现代gpu上 计算近似显式边界并且只有非常小的开销。具体方法是：</p>
<p>为每一个Cluster保存一个32-bit的整数。然后在逻辑上划分成三个10bit的区域。每一个都代表了隐式AABB中可能位置的范围。在这种模式下，显式的包围盒可以通过32-bit的原子或操作。</p>
<p>为了构造这个包围盒，我们利用内在的逐位函数从每个10位域的两个方向计数零，这些位然后被用来在每个轴方向上调整隐式AABB的大小</p>
<h3 id="Backface-Culling背面剪裁"><a href="#Backface-Culling背面剪裁" class="headerlink" title="Backface Culling背面剪裁"></a>Backface Culling背面剪裁</h3><p>不需要为背面朝向的光源的像素保存阴影数据。因为必定是不会被光源影响的。</p>

      
      <p align="right"><a class="morebtn" href="/2022/07/09/Paper/ClusterShadows/" title="More Efﬁcient Virtual Shadow Maps for Many Lights">阅读全文</a></p>
    </main>
    <footer class="post-footer">
      
    </footer>
  </article>
  
  <article class="article post card animate" itemscope itemtype="http://schema.org/Article">
    <div class="post-block">
      <link itemprop="mainEntityOfPage" href="http://leinlin.github.io/2022/07/09/GameAnalysis/%E7%B1%B3%E5%93%88%E6%B8%B8%E5%8E%9F%E7%A5%9E%E7%BB%86%E8%8A%82%E5%AE%9E%E7%8E%B0%E7%8C%9C%E6%B5%8B/">
      <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
        <meta itemprop="name" content="leinlin">
        <meta itemprop="description" content="">
        <meta itemprop="image" content="/images/avatar.jpg">
      </span>
      <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
        <meta itemprop="name" content="leinlin的小笔记">
      </span>
    </div>
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link post-title-link-external" href="/2022/07/09/GameAnalysis/%E7%B1%B3%E5%93%88%E6%B8%B8%E5%8E%9F%E7%A5%9E%E7%BB%86%E8%8A%82%E5%AE%9E%E7%8E%B0%E7%8C%9C%E6%B5%8B/" itemprop="url">原神制作细节猜测</a>
      </h1>
      <div class="post-meta">
        
        <span class="post-date">
          <i class="far fa-calendar-plus"></i><span><time title="post-date" itemprop="dateCreated datePublished" datetime="2022-07-09T12:00:14+08:00">2022-07-09 12:00:14</time></span>
        </span>
        
        
        
        <span class="post-meta-divider divider">|</span>
        
        <span class="post-categories">
          
          <i class="far fa-folder-open"></i><span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/GameAnalysis/" itemprop="url" rel="index"><span itemprop="name">GameAnalysis</span></a></span>
        </span>
        
        
        
        
      </div>
    </header>
    <main class="post-main" itemprop="articleBody">
      
      <h1 id="原神制作细节猜测"><a href="#原神制作细节猜测" class="headerlink" title="原神制作细节猜测"></a>原神制作细节猜测</h1><p>之前没有研究过手游，这里通过原神的视频试试分析他用了哪些技巧。主要是电脑视频分辨率太低了看不出来太多细节。</p>
<h2 id="镜面反射"><a href="#镜面反射" class="headerlink" title="镜面反射"></a>镜面反射</h2><p>最开始出场，使用了平面反射。</p>
<p><img src="/../../images/img/mirrorreflection.jpg" alt="mirrorreflection"></p>
<p>但是进入大世界场景之后平面反射被关闭了。</p>
<p><img src="/../../images/img/mirrorreflection2.jpg" alt="mirrorreflection2"></p>
<p>后面就是反射探针了</p>
<p><img src="/../../images/img/mirrorreflection3.jpg" alt="mirrorreflection3"></p>
<h2 id="植被"><a href="#植被" class="headerlink" title="植被"></a>植被</h2><p>草关闭了阴影</p>
<p><img src="/../../images/img/grassshadow.jpg" alt="grassshadow"></p>
<p>树应该烘焙了整体法线：</p>
<p><img src="/../../images/img/tree.jpg" alt="tree"></p>
<p>草的渲染距离：</p>
<p><img src="/../../images/img/2019623%E6%97%A5-123620.jpg" alt="2019623日-123620"></p>
<h2 id="阴影"><a href="#阴影" class="headerlink" title="阴影"></a>阴影</h2><p>人物接收阴影似乎经过了特殊的处理。似乎是标记了人物在什么位置接收阴影。<strong>因为他的阴影是突变了，没有一半在阴影中一般不在的状态。</strong>或者其他什么技术，可以看到下面的半阴影状态。</p>
<p><img src="/../../images/img/shadow.jpg" alt="shadow"></p>
<p><img src="/../../images/img/shadow2.jpg" alt="shadow2"></p>
<p>  阴影没了一大块：</p>
<p><img src="/../../images/img/shadow4.jpg" alt="shadow4"></p>
<p><img src="/../../images/img/shadow3.jpg" alt="shadow3"></p>
<p>有时候出现了奇怪的阴影这个应该是Bake的问题，有阴影没有物体。另外鱼没有阴影。</p>
<p><img src="/../../images/img/shadow5.jpg" alt="shadow5"></p>
<p>shadowmask下面的切换也很明显：</p>
<p><img src="/../../images/img/shadowmap6.jpg" alt="shadowmap6"></p>
<p><img src="/../../images/img/shadowmap4.jpg" alt="shadowmap4"></p>
<p><img src="/../../images/img/shadowmap5.jpg" alt="shadowmap5"></p>
<h2 id="区域"><a href="#区域" class="headerlink" title="区域"></a>区域</h2><p>感觉根据使用了很多标记区域，用来标记是否在水中，是否被打湿，是否在阴影中。</p>
<h2 id="扭曲"><a href="#扭曲" class="headerlink" title="扭曲"></a>扭曲</h2><p>特效专门做了一个扭曲的特效pass，按照崩坏3的思路应该是单独写一个扭曲的pass，然后在后处理做统一的扭曲，用grabpass太费了：</p>
<p><img src="/../../images/img/2019623%E6%97%A5-114222.jpg" alt="2019623日-114222"></p>
<h2 id="角色"><a href="#角色" class="headerlink" title="角色"></a>角色</h2><p>场景中只有角色开启了描边，其他物体似乎都没有。任务提示的箱子也没有。。</p>
<h2 id="LOD与CrossFade"><a href="#LOD与CrossFade" class="headerlink" title="LOD与CrossFade"></a>LOD与CrossFade</h2><p>下面两张图可以感受到LOD0的切换距离，从左上角的植被的细节，之所以说是LOD是因为他的模型和阴影是突变的：</p>
<p><img src="/../../images/img/LOD.jpg" alt="LOD"></p>
<p><img src="/../../images/img/LOD2.jpg" alt="LOD2"></p>
<p>从原到进 Shadow map的变化，整体的感觉是使用Cross Fade首先进行LOD替换，然后进行shadowmap第0级和第1级的替换。因为植物烘焙了整体法线所以看不出来cross fade效果。</p>
<p><img src="/../../images/img/shadowmap2.jpg" alt="shadowmap2"></p>
<p><img src="/../../images/img/shadowmap3.jpg" alt="shadowmap3"></p>
<p><img src="/../../images/img/shadowmap.jpg" alt="shadowmap"></p>
<p>进入城镇之后能够感受到其他物体LOD的距离，包括建筑的倒角细节和植物的：</p>
<p><img src="/../../images/img/lod3.jpg" alt="lod3"></p>
<p><img src="/../../images/img/lod4.jpg" alt="lod4"></p>
<h2 id="云的阴影"><a href="#云的阴影" class="headerlink" title="云的阴影"></a>云的阴影</h2><p>云飘过是的软阴影。</p>
<p><img src="/../../images/img/cloudshadow.jpg" alt="cloudshadow"></p>
<p><img src="/../../images/img/cloudshadow2.jpg" alt="cloudshadow2"></p>
<h2 id="场景交互"><a href="#场景交互" class="headerlink" title="场景交互"></a>场景交互</h2><p>和草有很多互动被燃烧、枯萎、我觉得被冰冻也可以加上,可能因为草需要交互所以尽可能的减少了交互，我觉得草的下半部分可以加深颜色，或者调整法线用来模拟一点阴影。</p>
<p><img src="/../../images/img/2019623%E6%97%A5-123252.jpg" alt="2019623日-123252"></p>
<p>技能落到地面上有水花，通过穿帮的地方能看出来是透明面片，游泳的水花也是一样的东西。</p>
<p><img src="/../../images/img/2019623%E6%97%A5-122904.jpg" alt="2019623日-122904"></p>
<p><img src="/../../images/img/2019623%E6%97%A5-122937.jpg" alt="2019623日-122937"></p>
<h2 id="Decal"><a href="#Decal" class="headerlink" title="Decal"></a>Decal</h2><p>可以看出来的部分，垂直方向的纹路被隐藏了，大部分都只能垂直向下投射，所以应该是有法线信息的，我猜测为了渲染Decal，额外多渲染了一次深度+法线，或者用已经有的深度贴图，渲染一次法线。</p>
<p><img src="/../../images/img/2019623%E6%97%A5-123941.jpg" alt="2019623日-123941"></p>
<p><img src="/../../images/img/2019623%E6%97%A5-124056.jpg" alt="2019623日-124056"><img src="/../../images/img/2019623%E6%97%A5-124006.jpg" alt="2019623日-124006"></p>

      
      <p align="right"><a class="morebtn" href="/2022/07/09/GameAnalysis/%E7%B1%B3%E5%93%88%E6%B8%B8%E5%8E%9F%E7%A5%9E%E7%BB%86%E8%8A%82%E5%AE%9E%E7%8E%B0%E7%8C%9C%E6%B5%8B/" title="原神制作细节猜测">阅读全文</a></p>
    </main>
    <footer class="post-footer">
      
    </footer>
  </article>
  
  <article class="article post card animate" itemscope itemtype="http://schema.org/Article">
    <div class="post-block">
      <link itemprop="mainEntityOfPage" href="http://leinlin.github.io/2022/07/09/HDRPsource/2.ShaderPass%E8%AF%B4%E6%98%8E/">
      <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
        <meta itemprop="name" content="leinlin">
        <meta itemprop="description" content="">
        <meta itemprop="image" content="/images/avatar.jpg">
      </span>
      <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
        <meta itemprop="name" content="leinlin的小笔记">
      </span>
    </div>
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link post-title-link-external" href="/2022/07/09/HDRPsource/2.ShaderPass%E8%AF%B4%E6%98%8E/" itemprop="url">HDRP ShaderPass说明</a>
      </h1>
      <div class="post-meta">
        
        <span class="post-date">
          <i class="far fa-calendar-plus"></i><span><time title="post-date" itemprop="dateCreated datePublished" datetime="2022-07-09T12:00:14+08:00">2022-07-09 12:00:14</time></span>
        </span>
        
        
        
        <span class="post-meta-divider divider">|</span>
        
        <span class="post-categories">
          
          <i class="far fa-folder-open"></i><span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/HDRPSource/" itemprop="url" rel="index"><span itemprop="name">HDRPSource</span></a></span>
        </span>
        
        
        
        
      </div>
    </header>
    <main class="post-main" itemprop="articleBody">
      
      <h1 id="HDRP-ShaderPass说明"><a href="#HDRP-ShaderPass说明" class="headerlink" title="HDRP ShaderPass说明"></a>HDRP ShaderPass说明</h1><h2 id="所有PassName"><a href="#所有PassName" class="headerlink" title="所有PassName"></a>所有PassName</h2><figure class="hljs highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs c#"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">HDShaderPassNames</span><br>&#123;<br>  <span class="hljs-comment">// ShaderPass string - use to have consistent name through the code</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">string</span> s_EmptyStr = <span class="hljs-string">&quot;&quot;</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">string</span> s_ForwardStr = <span class="hljs-string">&quot;Forward&quot;</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">string</span> s_DepthOnlyStr = <span class="hljs-string">&quot;DepthOnly&quot;</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">string</span> s_DepthForwardOnlyStr = <span class="hljs-string">&quot;DepthForwardOnly&quot;</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">string</span> s_ForwardOnlyStr = <span class="hljs-string">&quot;ForwardOnly&quot;</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">string</span> s_GBufferStr = <span class="hljs-string">&quot;GBuffer&quot;</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">string</span> s_GBufferWithPrepassStr = <span class="hljs-string">&quot;GBufferWithPrepass&quot;</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">string</span> s_SRPDefaultUnlitStr = <span class="hljs-string">&quot;SRPDefaultUnlit&quot;</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">string</span> s_MotionVectorsStr = <span class="hljs-string">&quot;MotionVectors&quot;</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">string</span> s_DistortionVectorsStr = <span class="hljs-string">&quot;DistortionVectors&quot;</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">string</span> s_TransparentDepthPrepassStr = <span class="hljs-string">&quot;TransparentDepthPrepass&quot;</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">string</span> s_TransparentBackfaceStr = <span class="hljs-string">&quot;TransparentBackface&quot;</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">string</span> s_TransparentDepthPostpassStr = <span class="hljs-string">&quot;TransparentDepthPostpass&quot;</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">string</span> s_MetaStr = <span class="hljs-string">&quot;Meta&quot;</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">string</span> s_ShadowCasterStr = <span class="hljs-string">&quot;ShadowCaster&quot;</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">string</span> s_MeshDecalsStr = <span class="hljs-string">&quot;DBufferMesh&quot;</span>;<br><br>  <span class="hljs-comment">// ShaderPass name</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> ShaderPassName s_EmptyName = <span class="hljs-keyword">new</span> ShaderPassName(s_EmptyStr);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> ShaderPassName s_ForwardName = <span class="hljs-keyword">new</span> ShaderPassName(s_ForwardStr);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> ShaderPassName s_DepthOnlyName = <span class="hljs-keyword">new</span> ShaderPassName(s_DepthOnlyStr);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> ShaderPassName s_DepthForwardOnlyName = <span class="hljs-keyword">new</span> ShaderPassName(s_DepthForwardOnlyStr);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> ShaderPassName s_ForwardOnlyName = <span class="hljs-keyword">new</span> ShaderPassName(s_ForwardOnlyStr);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> ShaderPassName s_GBufferName = <span class="hljs-keyword">new</span> ShaderPassName(s_GBufferStr);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> ShaderPassName s_GBufferWithPrepassName = <span class="hljs-keyword">new</span> ShaderPassName(s_GBufferWithPrepassStr);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> ShaderPassName s_SRPDefaultUnlitName = <span class="hljs-keyword">new</span> ShaderPassName(s_SRPDefaultUnlitStr);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> ShaderPassName s_MotionVectorsName = <span class="hljs-keyword">new</span> ShaderPassName(s_MotionVectorsStr);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> ShaderPassName s_DistortionVectorsName = <span class="hljs-keyword">new</span> ShaderPassName(s_DistortionVectorsStr);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> ShaderPassName s_TransparentDepthPrepassName = <span class="hljs-keyword">new</span> ShaderPassName(s_TransparentDepthPrepassStr);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> ShaderPassName s_TransparentBackfaceName = <span class="hljs-keyword">new</span> ShaderPassName(s_TransparentBackfaceStr);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> ShaderPassName s_TransparentDepthPostpassName = <span class="hljs-keyword">new</span> ShaderPassName(s_TransparentDepthPostpassStr);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> ShaderPassName s_MeshDecalsName = <span class="hljs-keyword">new</span> ShaderPassName(s_MeshDecalsStr);<br><br>  <span class="hljs-comment">// Legacy name 这部分的Pass都会作为ErrorPass渲染</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> ShaderPassName s_AlwaysName = <span class="hljs-keyword">new</span> ShaderPassName(<span class="hljs-string">&quot;Always&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> ShaderPassName s_ForwardBaseName = <span class="hljs-keyword">new</span> ShaderPassName(<span class="hljs-string">&quot;ForwardBase&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> ShaderPassName s_DeferredName = <span class="hljs-keyword">new</span> ShaderPassName(<span class="hljs-string">&quot;Deferred&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> ShaderPassName s_PrepassBaseName = <span class="hljs-keyword">new</span> ShaderPassName(<span class="hljs-string">&quot;PrepassBase&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> ShaderPassName s_VertexName = <span class="hljs-keyword">new</span> ShaderPassName(<span class="hljs-string">&quot;Vertex&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> ShaderPassName s_VertexLMRGBMName = <span class="hljs-keyword">new</span> ShaderPassName(<span class="hljs-string">&quot;VertexLMRGBM&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> ShaderPassName s_VertexLMName = <span class="hljs-keyword">new</span> ShaderPassName(<span class="hljs-string">&quot;VertexLM&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="Forward"><a href="#Forward" class="headerlink" title="Forward"></a>Forward</h2><p>所有在前向渲染物体使用这个Pass，正常情况下使用Deferred时，所有不透明物体都需要在DeferredPass 完成渲染，这里只渲染透明物体。</p>
<h2 id="ForwardOnly"><a href="#ForwardOnly" class="headerlink" title="ForwardOnly"></a>ForwardOnly</h2><p>通过ForwardOnly可以强制在Forward 阶段渲染不透明物体</p>
<p>无光照物体使用这个Pass，并且不输出法线</p>
<h2 id="DepthForwardOnly"><a href="#DepthForwardOnly" class="headerlink" title="DepthForwardOnly"></a>DepthForwardOnly</h2><p>和ForwardOnly对应使用</p>
<h2 id="DepthOnly"><a href="#DepthOnly" class="headerlink" title="DepthOnly"></a>DepthOnly</h2><p>渲染深度，Forward和Deferred必须有一个深度	</p>
<h2 id="TransparentDepthPrepass"><a href="#TransparentDepthPrepass" class="headerlink" title="TransparentDepthPrepass"></a>TransparentDepthPrepass</h2><p>透明物体Prepass深度</p>

      
      <p align="right"><a class="morebtn" href="/2022/07/09/HDRPsource/2.ShaderPass%E8%AF%B4%E6%98%8E/" title="HDRP ShaderPass说明">阅读全文</a></p>
    </main>
    <footer class="post-footer">
      
    </footer>
  </article>
  
  <article class="article post card animate" itemscope itemtype="http://schema.org/Article">
    <div class="post-block">
      <link itemprop="mainEntityOfPage" href="http://leinlin.github.io/2022/07/09/HDRPsource/10.Lighting%E8%AE%BE%E7%BD%AE/">
      <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
        <meta itemprop="name" content="leinlin">
        <meta itemprop="description" content="">
        <meta itemprop="image" content="/images/avatar.jpg">
      </span>
      <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
        <meta itemprop="name" content="leinlin的小笔记">
      </span>
    </div>
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link post-title-link-external" href="/2022/07/09/HDRPsource/10.Lighting%E8%AE%BE%E7%BD%AE/" itemprop="url">光照设置</a>
      </h1>
      <div class="post-meta">
        
        <span class="post-date">
          <i class="far fa-calendar-plus"></i><span><time title="post-date" itemprop="dateCreated datePublished" datetime="2022-07-09T12:00:14+08:00">2022-07-09 12:00:14</time></span>
        </span>
        
        
        
        <span class="post-meta-divider divider">|</span>
        
        <span class="post-categories">
          
          <i class="far fa-folder-open"></i><span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/HDRPSource/" itemprop="url" rel="index"><span itemprop="name">HDRPSource</span></a></span>
        </span>
        
        
        
        
      </div>
    </header>
    <main class="post-main" itemprop="articleBody">
      
      <h1 id="光照设置"><a href="#光照设置" class="headerlink" title="光照设置"></a>光照设置</h1><p>这里主要讲解GI的设置方式。</p>
<p>同时解释一下Shader是如何在<strong>光照探针</strong>、<strong>静态光照贴图</strong>，<strong>动态光照贴图</strong>，<strong>直接光照</strong>之间产生作用的。</p>
<p>首先看一下我们能设置的选项：</p>
<p>对于光源：</p>
<ol>
<li>realtime.</li>
<li>mix.</li>
<li>bake.</li>
</ol>
<p>对于emission（HDRP）：</p>
<ol>
<li>realtime.</li>
<li>bake.</li>
</ol>
<p>对于物体：</p>
<ol>
<li>lightmap static.</li>
<li>lightprobe.</li>
</ol>
<p>对于工程选项，在Windows&#x2F;Rendering&#x2F;Lighting Setting中的设置三部分：</p>
<ol>
<li>Realtime Lighting.</li>
<li>Mixed Lighting.</li>
<li>Lightmapping Setting.</li>
</ol>
<p>##测试场景</p>
<p>下面是测试场景：</p>
<p><img src="/../../images/10.%E5%85%89%E6%BA%90%E9%85%8D%E7%BD%AE.PNG" alt="光源配置"></p>
<p>测试场景当中有三个光源：红色点光源，绿色物体自发光，蓝色点光源，同时场景当中布满了光照探针。两个黑色模型，用于观察受光表现。（目前全部都是realtime光源，同时，物体是Lightmap static, realtime GI 和baked GI全部开启）。</p>
<p>从反面可以看到，红框内部就是间接光照。</p>
<p><img src="/../../images/10.%E5%85%89%E6%BA%90%E9%85%8D%E7%BD%AE%E5%8F%8D%E9%9D%A2.PNG" alt="光源配置"></p>
<p>接下来的内容会不断修改光源类型，物体类型设置和光照设置，来观察GI情况。</p>
<h2 id="光源类型"><a href="#光源类型" class="headerlink" title="光源类型"></a>光源类型</h2><p>光源有三种类型：realtime、mix、bake，如下图：</p>
<p><img src="/../../images/10.%E5%85%89%E6%BA%90%E7%B1%BB%E5%9E%8B.png"></p>
<p>每种类型的光都可以假设成由两部分组成：</p>
<p><strong>直接光照</strong>（直接照在某个物体上）</p>
<p><strong>间接光照</strong>。（经过物体反弹之后照在其他物体上）</p>
<h2 id="自发光"><a href="#自发光" class="headerlink" title="自发光"></a>自发光</h2><p>自发光也是一种光源：但是只有两种：realtime和bake。</p>
<p>这里有不同：</p>
<p>1.realtime：对应的是realtime类型光源的间接成分。</p>
<p>2.bake：对应的是bake类型的光源。</p>
<p><img src="/../../images/10.%E8%87%AA%E5%8F%91%E5%85%89%E7%B1%BB%E5%9E%8B.png"></p>
<h2 id="物体受光"><a href="#物体受光" class="headerlink" title="物体受光"></a>物体受光</h2><p>物体上和受光相关的有两个设置：</p>
<ol>
<li>lightmap static是否打开。</li>
<li>lightprobe 是否打开。</li>
</ol>
<p>选项位置见下图：</p>
<p><img src="/../../images/10.%E7%89%A9%E4%BD%93%E5%85%89%E7%85%A7%E7%B1%BB%E5%9E%8B.png"></p>
<p>下面讨论每个情况。</p>
<p>###LightMap Static物体</p>
<p>​	LightMap Static打开时受光来源：Realtime GI贴图 + Baked GI贴图 + realtime 光的直接光照 + mix 光的直接光照。(贴图内容和探针内容在后面解释)</p>
<p>当前场景两个物体都是lightMap Static。我们把测试场景中蓝色光改成bake，这个时候两个lightmap static物体的光照贴图如下。</p>
<p><img src="/../../images/10.%E7%89%A9%E4%BD%93%E5%8F%97%E5%85%89%E6%83%85%E5%86%B5.png"></p>
<p>​	从上图可以看到，蓝色光源被bake到baked lightmap中，realtime光源和realtime自发光被bake到realtimeGI当中。同时，下图是物体背面的受光情况，可以看到，间接光都存在。</p>
<p><img src="/../../images/10.%E7%89%A9%E4%BD%93%E5%8F%97%E5%85%89%E6%83%85%E5%86%B5%E8%83%8C%E9%9D%A2.PNG"></p>
<p>接下来我们在做一个实验，在运行模式下修改三个光源的颜色，</p>
<p>​	红色realtime点光源-&gt;蓝色realtime点光源， 绿色realtime自发光-&gt;黄色realtime自发光， 蓝色baked点光源-&gt;红色baked自发光</p>
<p>下图为修改后的结果，可以发现。两个点光源的变化是合理的。但是realtime GI贴图上的realtime自发光并没有变化（就是说在Play模式下并不是realtime的）。同时我发现，在编辑模式下，我修改自发光颜色realtimeGI贴图不用重新烘焙就会马上变（就是说在Editor模式下是realtime的），这个可能是bug。</p>
<p><img src="/../../images/10.%E4%BF%AE%E6%94%B9%E5%85%89%E6%BA%90%E9%A2%9C%E8%89%B2.PNG"></p>
<p>###Lightprobe物体</p>
<p>打开时受光来源： realtime光的直接光照 + mix光的直接光照 + 光照探针。</p>
<p>​	我们把下方平面取消掉lightmap static，这样这个物体就会使用LightProbe作为间接光。同时保持左侧为realtime红色光，右侧为bake蓝色光，中间为realtime自发光。</p>
<p><img src="/../../images/10.LightProbe%E7%BB%93%E6%9E%9C.PNG"></p>
<p>​	从上图可以看到，光照探针烘焙了所有的间接光（红绿蓝）。同时下方平面不再接受GI贴图，而间接光是通过光照探针插值来的（有个很重要的地方是：realtime的自发光和baked点光源表现居然是一样的的效果），选择平面后可以看到插值用到的光照探针。可以看到光照效果很差，所以大物体不适合使用探针。</p>
<p>###特殊说明</p>
<ol>
<li>如果为一个物体烘焙了光照贴图，那么即使取消了lightmap static，lightprobe也不会生效（灰色状态），必须手动清除光照贴图。</li>
</ol>
<p><img src="/../../images/10.%E9%94%99%E8%AF%AF%E5%85%89%E7%85%A7%E7%8A%B6%E6%80%811.PNG"></p>
<ol start="2">
<li>如果一个物体还没有烘焙光照贴图，那么即使LightMap Static打开，Lightprobe也可以打开（正常情况他们是互斥的）。</li>
</ol>
<p><img src="/../../images/10.%E9%94%99%E8%AF%AF%E5%85%89%E7%85%A7%E7%8A%B6%E6%80%812.PNG"></p>
<p>上面两种情况就是光照信息错误的状态。</p>
<p>物体受光可以参考一下Shader当中的逻辑：</p>
<figure class="hljs highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c">float3 <span class="hljs-title function_">SampleBakedGI</span><span class="hljs-params">(float3 positionRWS, float3 normalWS, float2 uvStaticLightmap, float2 uvDynamicLightmap)</span><br>&#123;<br><span class="hljs-meta">#<span class="hljs-keyword">if</span> !defined(LIGHTMAP_ON) &amp;&amp; !defined(DYNAMICLIGHTMAP_ON)</span><br>	<span class="hljs-comment">// If there is no lightmap, it assume lightprobe</span><br>  	...<br><span class="hljs-meta">#<span class="hljs-keyword">else</span></span><br><br>    float3 bakeDiffuseLighting = float3(<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>);<br><br>    <span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> LIGHTMAP_ON</span><br>        bakeDiffuseLighting += SampleDirectionalLightmap();<br>    <span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br>    <span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> DYNAMICLIGHTMAP_ON</span><br>        bakeDiffuseLighting += SampleSingleLightmap()<br>    <span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br>    <span class="hljs-keyword">return</span> bakeDiffuseLighting;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="光源烘焙"><a href="#光源烘焙" class="headerlink" title="光源烘焙"></a>光源烘焙</h2><p>三种光源（每种光源的两个部分）和两种emission通过光照烘焙之后会通过不同的方式对物体产生影响。</p>
<ol>
<li>Realtime GI贴图： Realtime Light的间接部分  + realtime emission。</li>
<li>Baked GI贴图：Mix Light的间接部分 + Baked Light的全部 + baked emission。</li>
<li>实时光照计算： Realtime的直接部分 + MixLight的直接部分。</li>
<li>光头照探针里面：Mix Light的间接部分 + Baked Light的全部 + baked emission+ Realtime Light的间接部分</li>
</ol>
<p>这里特殊说明mix 光源类型我们关掉自发光，将红光变成mix点光源，蓝光还是bake。</p>
<p><img src="/../../images/10.mix%E5%85%89%E6%BA%90.PNG"></p>
<p>此时法线，realtime的间接光烘焙到了bakelightmap当中。此时如果在Play模式下变化mix点光源，只有直接光会变化，而Baked lilghtmap不会变化，如果在运行过程中，把红色点光源变化realtime，则Realtime lightmap中也不计算间接光，因为没有预先烘焙的信息。</p>
<p>​	<strong>结合上一部分的特殊说明：所有GI内容和物体类型，必须在设置好之后统一bake一次。在修改了物体类型和光照类型之后，也必须重新bake，场景光照才会正确。</strong></p>
<h2 id="光照设置-1"><a href="#光照设置-1" class="headerlink" title="光照设置"></a>光照设置</h2><p>光照设置有下面三块：</p>
<ol>
<li>Realtime Lighting.</li>
<li>Mixed Lighting.</li>
<li>Lightmapping Setting.</li>
</ol>
<p>###Realtime Lighting</p>
<p>这个下面只有一个开关。Realtime Global Illumination，用于控制是否生成Realtime GI贴图。</p>
<p>如果不选择。那么对于LightMap Static打开的物体受光就会发生改变：</p>
<p>从   :</p>
<p><strong>Realtime GI贴图 + Baked GI贴图 + realtime 光的直接光照 + mix 光的直接光照。</strong> </p>
<p>变成 :</p>
<p>​                                   <strong>Baked GI贴图 + realtime 光的直接光照 + mix 光的直接光照</strong>。</p>
<h3 id="Mixed-Lighting"><a href="#Mixed-Lighting" class="headerlink" title="Mixed Lighting"></a>Mixed Lighting</h3><p>这个下面有一个开关，Baked  Global Illumination用于控制是否生成Baked GI贴图。</p>
<p>效果和上面的Realtime Global Illumination一致。</p>
<p>还有一个选项Lighting Mode。这个用于控制MixLight对于ShadowMask之类的类容有所影响，对于前面的内容没有影响。</p>
<p>下面是三种设置情况对应的物体接受光照贴图的情况：</p>
<p>1.Realtime GI开Baked GI开</p>
<p><img src="/../../images/10.%E5%85%89%E7%85%A7%E8%AE%BE%E7%BD%AE1.PNG"></p>
<p>2.Realtime GI关Baked GI开</p>
<p><img src="/../../images/10.%E5%85%89%E7%85%A7%E8%AE%BE%E7%BD%AE2.PNG"></p>
<p>3.Realtime GI开Baked GI关</p>
<p><img src="/../../images/10.%E5%85%89%E7%85%A7%E8%AE%BE%E7%BD%AE3.PNG"></p>
<h3 id="Lightmapping-Setting"><a href="#Lightmapping-Setting" class="headerlink" title="Lightmapping Setting"></a>Lightmapping Setting</h3><p>这个主要用来控制 <strong>Baked GI贴图</strong>如何生成。</p>
<p>Directional Mode 开始 对于<strong>Baked GI贴图</strong>和<strong>Realtime GI贴图</strong>同时生效。</p>

      
      <p align="right"><a class="morebtn" href="/2022/07/09/HDRPsource/10.Lighting%E8%AE%BE%E7%BD%AE/" title="光照设置">阅读全文</a></p>
    </main>
    <footer class="post-footer">
      
    </footer>
  </article>
  
  <article class="article post card animate" itemscope itemtype="http://schema.org/Article">
    <div class="post-block">
      <link itemprop="mainEntityOfPage" href="http://leinlin.github.io/2022/07/09/HDRPsource/1.%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84/">
      <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
        <meta itemprop="name" content="leinlin">
        <meta itemprop="description" content="">
        <meta itemprop="image" content="/images/avatar.jpg">
      </span>
      <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
        <meta itemprop="name" content="leinlin的小笔记">
      </span>
    </div>
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link post-title-link-external" href="/2022/07/09/HDRPsource/1.%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84/" itemprop="url">代码结构</a>
      </h1>
      <div class="post-meta">
        
        <span class="post-date">
          <i class="far fa-calendar-plus"></i><span><time title="post-date" itemprop="dateCreated datePublished" datetime="2022-07-09T12:00:14+08:00">2022-07-09 12:00:14</time></span>
        </span>
        
        
        
        <span class="post-meta-divider divider">|</span>
        
        <span class="post-categories">
          
          <i class="far fa-folder-open"></i><span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/HDRPSource/" itemprop="url" rel="index"><span itemprop="name">HDRPSource</span></a></span>
        </span>
        
        
        
        
      </div>
    </header>
    <main class="post-main" itemprop="articleBody">
      
      <h1 id="代码结构"><a href="#代码结构" class="headerlink" title="代码结构"></a>代码结构</h1><p>hdrp的所有渲染过程描述在HDRenderPipeline类的Render方法当中：</p>
<figure class="hljs highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c#"><span class="hljs-keyword">namespace</span> <span class="hljs-title">UnityEngine.Experimental.Rendering.HDPipeline</span><br>&#123;<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">HDRenderPipeline</span> &#123;<br>	...<br>		 <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Render</span>(<span class="hljs-params"></span></span><br><span class="hljs-params"><span class="hljs-function">		 	ScriptableRenderContext renderContext, Camera[] cameras</span></span><br><span class="hljs-params"><span class="hljs-function">		 	</span>)</span><br><span class="hljs-function">	...</span><br><span class="hljs-function">	&#125;</span><br><span class="hljs-function">&#125;</span><br></code></pre></td></tr></table></figure>

<h1 id="Render方法"><a href="#Render方法" class="headerlink" title="Render方法"></a>Render方法</h1><p>render方法当中的主要输入的ScriptableRenderContext和Camera列表：</p>
<p>ScriptableRenderContext：定义状态、收集渲染命令。</p>
<p>摄像机列表</p>
<h2 id="render主要过程"><a href="#render主要过程" class="headerlink" title="render主要过程"></a>render主要过程</h2><p>收件进行物体剪裁</p>
<p>然后调用一系列DrawRenderers和CommandBuffer</p>
<p>最终提交</p>
<figure class="hljs highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c#"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Render</span>(<span class="hljs-params">ScriptableRenderContext renderContext, Camera[] cameras</span>)</span><br>&#123;<br>  	<span class="hljs-comment">//调用父类方法</span><br>  	<span class="hljs-keyword">base</span>.Render(renderContext, cameras);<br>  <br>  	<span class="hljs-comment">//渲染时间控制</span><br>    &#123;<br><br>    &#125;<br>  <br>  	<span class="hljs-comment">// 渲染平面反射 ：统计需要渲染的反射类型：反射探针 和 平面反射</span><br>  	<span class="hljs-comment">// 通过深层调用可以发现最终调用的是 renderCamera.Render();</span><br>    ReflectionSystem.RenderAllRealtimeProbes(probeTypeToRender);<br>  <br>  	<span class="hljs-comment">// 更新HDRP assets 设置</span><br>    m_Asset.UpdateDirtyFrameSettings();<br>  <br>    <span class="hljs-comment">// 为每个摄像机循环渲染</span><br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> camera <span class="hljs-keyword">in</span> cameras)<br>    &#123;<br>      RenderPipeline.BeginCameraRendering(camera);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h2 id="为每个摄像机循环渲染"><a href="#为每个摄像机循环渲染" class="headerlink" title="为每个摄像机循环渲染"></a>为每个摄像机循环渲染</h2><h3 id="准备设置参数"><a href="#准备设置参数" class="headerlink" title="准备设置参数"></a>准备设置参数</h3><figure class="hljs highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c#"><span class="hljs-keyword">if</span> (camera == <span class="hljs-literal">null</span>) <span class="hljs-keyword">continue</span>;<br><br><span class="hljs-comment">// 首先从摄像机上获取摄像机设置。</span><br><span class="hljs-keyword">var</span> additionalCameraData = camera.GetComponent&lt;HDAdditionalCameraData&gt;();<br>FrameSettings srcFrameSettings;<br><span class="hljs-comment">// 如果有这个组件则从组件当中获取最新设置FrameSettings。</span><br><span class="hljs-keyword">if</span> (additionalCameraData)<br>&#123;                additionalCameraData.UpdateDirtyFrameSettings(assetFrameSettingsIsDirty, m_Asset.GetFrameSettings());<br> srcFrameSettings = additionalCameraData.GetFrameSettings();<br> &#125;<br><span class="hljs-comment">// 如果没有则从HDRenderPipelineAsset中获取设置</span><br><span class="hljs-keyword">else</span><br>&#123;<br>    srcFrameSettings = m_Asset.GetFrameSettings();<br>&#125;<br><br><span class="hljs-comment">//  根据各方面内容初始化帧设置。</span><br>   FrameSettings currentFrameSettings = <span class="hljs-keyword">new</span> FrameSettings();<br> FrameSettings.InitializeFrameSettings(camera, m_Asset.GetRenderPipelineSettings(), srcFrameSettings, <span class="hljs-keyword">ref</span> currentFrameSettings);<br><br><br></code></pre></td></tr></table></figure>



<figure class="hljs highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs c#"><span class="hljs-comment">//初始化commandbuffer来提交主要的渲染命令</span><br><span class="hljs-keyword">var</span> cmd = CommandBufferPool.Get(<span class="hljs-string">&quot;&quot;</span>);<br><br><span class="hljs-comment">// 完全自定义内容的摄像机，不进入渲染过程</span><br><span class="hljs-keyword">if</span> (additionalCameraData <br>&amp;&amp; additionalCameraData.renderingPath == HDAdditionalCameraData.RenderingPath.FullscreenPassthrough)<br>&#123;<br>  <span class="hljs-comment">// 直接提交一个空的command buffer执行</span><br>  <span class="hljs-comment">// 这里思考一下我们的Command在哪里起作用</span><br>  renderContext.ExecuteCommandBuffer(cmd);<br>  CommandBufferPool.Release(cmd);<br>  renderContext.Submit();<br>  <span class="hljs-keyword">continue</span>;<br>&#125;<br><br><span class="hljs-comment">// 渲染反射：如果注意就可以发现，上面也有一个RenderAllRealtimeViewerDependentProbes区别在于上面的没有提供摄像机，一个是静态的、一个是为当前摄像机渲染的动态的。</span><br><span class="hljs-keyword">if</span> (camera.cameraType != CameraType.Reflection &amp;&amp; camera.cameraType != CameraType.Preview &amp;&amp; !camera.orthographic) ReflectionSystem.RenderAllRealtimeViewerDependentProbesFor(ReflectionProbeType.PlanarReflection, camera);<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">可以查看反射探针和镜面反射探针，都保存在下面的数组中</span><br><span class="hljs-comment">m_PlanarReflectionProbe_PerCamera_RealtimeUpdate</span><br><span class="hljs-comment">m_PlanarReflectionProbe_RealtimeUpdate_WorkArray</span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-comment">// 初始化材质资源，材质列表中每个材质需要的资源初始化。用cmd来申请</span><br><span class="hljs-comment">// m_MaterialList如何填充的？</span><br><span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> material <span class="hljs-keyword">in</span> m_MaterialList)<br>   material.RenderInit(cmd);<br><br><span class="hljs-comment">// 使用ProfilingSamplig采样渲染</span><br><span class="hljs-comment">// 填充CommandBuffer来指定渲染过程</span><br><span class="hljs-keyword">using</span> (<span class="hljs-keyword">new</span> ProfilingSample(cmd, <span class="hljs-string">&quot;HDRenderPipeline::Render&quot;</span>, CustomSamplerId.HDRenderPipelineRender.GetSampler()))<br>&#123;<br>   <br>&#125;<br><br><span class="hljs-comment">// 执行组装好的CommandBuffer</span><br>renderContext.ExecuteCommandBuffer(cmd);<br><span class="hljs-comment">// 释放</span><br>CommandBufferPool.Release(cmd);<br><span class="hljs-comment">// 提交</span><br>renderContext.Submit();<br><br><span class="hljs-comment">// 和调试相关的内容暂时忽略</span><br><span class="hljs-keyword">if</span> (m_CurrentDebugDisplaySettings.fullScreenDebugMode == FullScreenDebugMode.ScreenSpaceTracing)<br>&#123;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="填充CommandBuffer来指定渲染过程"><a href="#填充CommandBuffer来指定渲染过程" class="headerlink" title="填充CommandBuffer来指定渲染过程"></a>填充CommandBuffer来指定渲染过程</h4><figure class="hljs highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs c#"><br><span class="hljs-comment">// 初始化设置  @@</span><br>m_LightLoop.NewFrame(currentFrameSettings);<br><br><span class="hljs-comment">// 根据摄像机类型设置m_CurrentDebugDisplaySettings</span><br><span class="hljs-keyword">if</span> (camera.cameraType == CameraType.Reflection || camera.cameraType == CameraType.Preview)<br>&#123;<br>  m_CurrentDebugDisplaySettings = s_NeutralDebugDisplaySettings;<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>  m_CurrentDebugDisplaySettings = m_DebugDisplaySettings;<br>&#125;<br><br><span class="hljs-comment">// Volume相关的处理</span><br><span class="hljs-keyword">using</span> (<span class="hljs-keyword">new</span> ProfilingSample(cmd, <span class="hljs-string">&quot;Volume Update&quot;</span>, CustomSamplerId.VolumeUpdate.GetSampler()))<br>&#123;<br>&#125;<br><br><span class="hljs-comment">// 或处理判断</span><br><span class="hljs-keyword">var</span> postProcessLayer = camera.GetComponent&lt;PostProcessLayer&gt;();<br><span class="hljs-comment">// Disable post process if we enable debug mode or if the post process layer is disabled</span><br><span class="hljs-keyword">if</span> (m_CurrentDebugDisplaySettings.IsDebugDisplayRemovePostprocess() || !HDUtils.IsPostProcessingActive(postProcessLayer))<br>&#123;<br>  currentFrameSettings.enablePostprocess = <span class="hljs-literal">false</span>;<br>&#125;<br><span class="hljs-comment">// 摄像机HDCamera设置，体积光系统？</span><br><span class="hljs-keyword">var</span> hdCamera = HDCamera.Get(camera);<br><span class="hljs-keyword">if</span> (hdCamera == <span class="hljs-literal">null</span>)<br>&#123;<br>  	hdCamera = HDCamera.Create(camera, m_VolumetricLightingSystem);<br>&#125;<br>hdCamera.Update(currentFrameSettings, postProcessLayer, m_VolumetricLightingSystem);<br>Resize(hdCamera);<br>ApplyDebugDisplaySettings(hdCamera, cmd);<br>UpdateShadowSettings(hdCamera);<br>m_SkyManager.UpdateCurrentSkySettings(hdCamera);<br></code></pre></td></tr></table></figure>

<h4 id="剪裁"><a href="#剪裁" class="headerlink" title="剪裁"></a>剪裁</h4><figure class="hljs highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c#">ScriptableCullingParameters cullingParams;<br><span class="hljs-keyword">if</span> (!CullResults.GetCullingParameters(camera, hdCamera.frameSettings.enableStereo, <span class="hljs-keyword">out</span> cullingParams))<br>&#123;<br>  renderContext.Submit();<br>  <span class="hljs-keyword">continue</span>;<br>&#125;<br>m_LightLoop.UpdateCullingParameters(<span class="hljs-keyword">ref</span> cullingParams);<br>hdCamera.UpdateStereoDependentState(<span class="hljs-keyword">ref</span> cullingParams);<br></code></pre></td></tr></table></figure>

<p>####一堆看不懂的设置</p>
<figure class="hljs highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs c#"><span class="hljs-keyword">if</span> (hdCamera.frameSettings.enableDBuffer)<br>&#123;<br>  <span class="hljs-comment">// decal system needs to be updated with current camera, it needs it to set up culling and light list generation parameters</span><br>  DecalSystem.instance.CurrentCamera = camera;<br>  DecalSystem.instance.BeginCull();<br>&#125;<br><br>ReflectionSystem.PrepareCull(camera, m_ReflectionProbeCullResults);<br><br><span class="hljs-keyword">using</span> (<span class="hljs-keyword">new</span> ProfilingSample(cmd, <span class="hljs-string">&quot;CullResults.Cull&quot;</span>, CustomSamplerId.CullResultsCull.GetSampler()))<br>&#123;<br>  CullResults.Cull(<span class="hljs-keyword">ref</span> cullingParams, renderContext, <span class="hljs-keyword">ref</span> m_CullResults);<br>&#125;<br><br>m_ReflectionProbeCullResults.Cull();<br><br>m_DbufferManager.EnableDBUffer = <span class="hljs-literal">false</span>;<br><span class="hljs-keyword">using</span> (<span class="hljs-keyword">new</span> ProfilingSample(cmd, <span class="hljs-string">&quot;DBufferPrepareDrawData&quot;</span>, CustomSamplerId.DBufferPrepareDrawData.GetSampler()))<br>&#123;<br>  <span class="hljs-keyword">if</span> (hdCamera.frameSettings.enableDBuffer)<br>  &#123;<br>    DecalSystem.instance.EndCull();<br>    m_DbufferManager.EnableDBUffer = <span class="hljs-literal">true</span>;              <span class="hljs-comment">// mesh decals are renderers managed by c++ runtime and we have no way to query if any are visible, so set to true</span><br>    DecalSystem.instance.UpdateCachedMaterialData();    <span class="hljs-comment">// textures, alpha or fade distances could&#x27;ve changed</span><br>    DecalSystem.instance.CreateDrawData();              <span class="hljs-comment">// prepare data is separate from draw</span><br>    DecalSystem.instance.UpdateTextureAtlas(cmd);       <span class="hljs-comment">// as this is only used for transparent pass, would&#x27;ve been nice not to have to do this if no transparent renderers are visible, needs to happen after CreateDrawData</span><br>  &#125;<br>&#125;<br>renderContext.SetupCameraProperties(camera, hdCamera.frameSettings.enableStereo);<br><br>PushGlobalParams(hdCamera, cmd, diffusionProfileSettings);<br><br><span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Find a correct place to bind these material textures</span><br><span class="hljs-comment">// We have to bind the material specific global parameters in this mode</span><br>m_MaterialList.ForEach(material =&gt; material.Bind());<br><br><span class="hljs-comment">// Frustum cull density volumes on the CPU. Can be performed as soon as the camera is set up.</span><br>DensityVolumeList densityVolumes = m_VolumetricLightingSystem.PrepareVisibleDensityVolumeList(hdCamera, cmd, m_Time);<br><br><span class="hljs-comment">// Note: Legacy Unity behave like this for ShadowMask</span><br><span class="hljs-comment">// When you select ShadowMask in Lighting panel it recompile shaders on the fly with the SHADOW_MASK keyword.</span><br><span class="hljs-comment">// However there is no C# function that we can query to know what mode have been select in Lighting Panel and it will be wrong anyway. Lighting Panel setup what will be the next bake mode. But until light is bake, it is wrong.</span><br><span class="hljs-comment">// Currently to know if you need shadow mask you need to go through all visible lights (of CullResult), check the LightBakingOutput struct and look at lightmapBakeType/mixedLightingMode. If one light have shadow mask bake mode, then you need shadow mask features (i.e extra Gbuffer).</span><br><span class="hljs-comment">// It mean that when we build a standalone player, if we detect a light with bake shadow mask, we generate all shader variant (with and without shadow mask) and at runtime, when a bake shadow mask light is visible, we dynamically allocate an extra GBuffer and switch the shader.</span><br><span class="hljs-comment">// So the first thing to do is to go through all the light: PrepareLightsForGPU</span><br><span class="hljs-built_in">bool</span> enableBakeShadowMask;<br><span class="hljs-keyword">using</span> (<span class="hljs-keyword">new</span> ProfilingSample(cmd, <span class="hljs-string">&quot;TP_PrepareLightsForGPU&quot;</span>, CustomSamplerId.TPPrepareLightsForGPU.GetSampler()))<br>&#123;<br>  enableBakeShadowMask = m_LightLoop.PrepareLightsForGPU(cmd, hdCamera, m_ShadowSettings, m_CullResults, m_ReflectionProbeCullResults, densityVolumes);<br>&#125;<br>ConfigureForShadowMask(enableBakeShadowMask, cmd);<br><br></code></pre></td></tr></table></figure>

<h4 id="正式开始渲染-必要部分1"><a href="#正式开始渲染-必要部分1" class="headerlink" title="正式开始渲染:必要部分1"></a>正式开始渲染:必要部分1</h4><figure class="hljs highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs c#">StartStereoRendering(renderContext, hdCamera);<br>ClearBuffers(hdCamera, cmd);<br><br><span class="hljs-comment">// 预先深度</span><br>RenderDepthPrepass(m_CullResults, hdCamera, renderContext, cmd);<br><br><span class="hljs-comment">// 渲染深度给Decal使用</span><br>RenderDBuffer(hdCamera, cmd, renderContext, m_CullResults);<br><br><span class="hljs-comment">// 渲染Gbuffer</span><br>RenderGBuffer(m_CullResults, hdCamera, enableBakeShadowMask, renderContext, cmd);<br><br><span class="hljs-comment">// 绑定NormalBuffer到某个外部纹理？？</span><br>m_NormalBufferManager.BindNormalBuffers(cmd);<br><br><span class="hljs-comment">// 渲染深度和深度金字塔</span><br>CopyDepthBufferIfNeeded(cmd);<br>RenderDepthPyramid(hdCamera, cmd, renderContext, FullScreenDebugMode.DepthPyramid);<br><br><span class="hljs-comment">// 渲染MotionVector？？</span><br>RenderObjectsVelocity(m_CullResults, hdCamera, renderContext, cmd);<br>RenderCameraVelocity(m_CullResults, hdCamera, renderContext, cmd);<br><br><span class="hljs-comment">// 设置全局的深度纹理</span><br>cmd.SetGlobalTexture(HDShaderIDs._CameraDepthTexture, GetDepthTexture());<br><br><span class="hljs-comment">// 天空盒更新</span><br>UpdateSkyEnvironment(hdCamera, cmd);<br><br>StopStereoRendering(renderContext, hdCamera);<br><br><span class="hljs-keyword">if</span> (m_CurrentDebugDisplaySettings.IsDebugMaterialDisplayEnabled())<br>&#123;<br>  RenderDebugViewMaterial(m_CullResults, hdCamera, renderContext, cmd);<br><br>  PushColorPickerDebugTexture(cmd, m_CameraColorBuffer, hdCamera);<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>  <span class="hljs-comment">//正式开始渲染:必要部分2</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>####正式开始渲染:必要部分2 </p>
<figure class="hljs highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs c#">StartStereoRendering(renderContext, hdCamera);<br><br><span class="hljs-keyword">using</span> (<span class="hljs-keyword">new</span> ProfilingSample(cmd, <span class="hljs-string">&quot;Render SSAO&quot;</span>, CustomSamplerId.RenderSSAO.GetSampler()))<br>&#123;<br>	<span class="hljs-comment">//渲染SSAO，屏幕空间环境光，这里需要PostProcessing？？？</span><br>  RenderSSAO(cmd, hdCamera, renderContext, postProcessLayer);<br>&#125;<br><br><br><span class="hljs-comment">// FeatureVariamts ??? 和Stencil相关</span><br><span class="hljs-keyword">if</span> (m_LightLoop.GetFeatureVariantsEnabled())<br>&#123;<br>  <span class="hljs-comment">// For material classification we use compute shader and so can&#x27;t read into the stencil, so prepare it.</span><br>  <span class="hljs-keyword">using</span> (<span class="hljs-keyword">new</span> ProfilingSample(cmd, <span class="hljs-string">&quot;Clear and copy stencil texture&quot;</span>, CustomSamplerId.ClearAndCopyStencilTexture.GetSampler()))<br>  &#123;<br>    HDUtils.SetRenderTarget(cmd, hdCamera, m_CameraStencilBufferCopy, ClearFlag.Color, CoreUtils.clearColorAllBlack);<br><br>    <span class="hljs-comment">// In the material classification shader we will simply test is we are no lighting</span><br>    <span class="hljs-comment">// Use ShaderPassID 1 =&gt; &quot;Pass 1 - Write 1 if value different from stencilRef to output&quot;</span><br>    HDUtils.DrawFullScreen(cmd, hdCamera, m_CopyStencilForNoLighting, m_CameraStencilBufferCopy, m_CameraDepthStencilBuffer, <span class="hljs-literal">null</span>, <span class="hljs-number">1</span>);<br>  &#125;<br>&#125;<br><br>StopStereoRendering(renderContext, hdCamera);<br><br><span class="hljs-comment">// 异步计算阴影？？</span><br>GPUFence buildGPULightListsCompleteFence = <span class="hljs-keyword">new</span> GPUFence();<br><span class="hljs-keyword">if</span> (hdCamera.frameSettings.enableAsyncCompute)<br>&#123;<br>  GPUFence startFence = cmd.CreateGPUFence();<br>  renderContext.ExecuteCommandBuffer(cmd);<br>  cmd.Clear();<br><br>  buildGPULightListsCompleteFence = m_LightLoop.BuildGPULightListsAsyncBegin(hdCamera, renderContext, m_CameraDepthStencilBuffer, m_CameraStencilBufferCopy, startFence, m_SkyManager.IsLightingSkyValid());<br>&#125;<br><br><span class="hljs-comment">//正式开始渲染:必要部分3 </span><br></code></pre></td></tr></table></figure>



<p>####正式开始渲染:必要部分3 </p>
<figure class="hljs highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><code class="hljs c#"> <span class="hljs-comment">// 渲染阴影</span><br><span class="hljs-keyword">using</span> (<span class="hljs-keyword">new</span> ProfilingSample(cmd, <span class="hljs-string">&quot;Render shadows&quot;</span>, CustomSamplerId.RenderShadows.GetSampler()))<br>&#123;<br>  m_LightLoop.RenderShadows(renderContext, cmd, m_CullResults);<br><br>  <span class="hljs-comment">// Overwrite camera properties set during the shadow pass with the original camera properties.</span><br>  renderContext.SetupCameraProperties(camera, hdCamera.frameSettings.enableStereo);<br>  hdCamera.SetupGlobalParams(cmd, m_Time, m_LastTime, m_FrameCount);<br>  <span class="hljs-keyword">if</span> (hdCamera.frameSettings.enableStereo)<br>    hdCamera.SetupGlobalStereoParams(cmd);<br>&#125;<br><br><span class="hljs-comment">// 渲染deffered直接阴影</span><br><span class="hljs-keyword">using</span> (<span class="hljs-keyword">new</span> ProfilingSample(cmd, <span class="hljs-string">&quot;Deferred directional shadows&quot;</span>, CustomSamplerId.RenderDeferredDirectionalShadow.GetSampler()))<br>&#123;<br>    <span class="hljs-comment">// When debug is enabled we need to clear otherwise we may see non-shadows areas with stale values.</span><br>    <span class="hljs-keyword">if</span> (m_CurrentDebugDisplaySettings.fullScreenDebugMode == FullScreenDebugMode.DeferredShadows)<br>    &#123;<br>      HDUtils.SetRenderTarget(cmd, hdCamera, m_DeferredShadowBuffer, ClearFlag.Color, CoreUtils.clearColorAllBlack);<br>    &#125;<br><br>    m_LightLoop.RenderDeferredDirectionalShadow(hdCamera, m_DeferredShadowBuffer, GetDepthTexture(), cmd);<br>    PushFullScreenDebugTexture(hdCamera, cmd, m_DeferredShadowBuffer, FullScreenDebugMode.DeferredShadows);<br>&#125;<br><br><span class="hljs-comment">// 异步计算阴影结束？</span><br><span class="hljs-keyword">if</span> (hdCamera.frameSettings.enableAsyncCompute)<br>&#123;<br>  m_LightLoop.BuildGPULightListAsyncEnd(hdCamera, cmd, buildGPULightListsCompleteFence);<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>  <span class="hljs-comment">// 配置光照列表</span><br>  <span class="hljs-keyword">using</span> (<span class="hljs-keyword">new</span> ProfilingSample(cmd, <span class="hljs-string">&quot;Build Light list&quot;</span>, CustomSamplerId.BuildLightList.GetSampler()))<br>  &#123;<br>    m_LightLoop.BuildGPULightLists(hdCamera, cmd, m_CameraDepthStencilBuffer, m_CameraStencilBufferCopy, m_SkyManager.IsLightingSkyValid());<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 和体积光相关的雾参数</span><br>&#123;<br>  <span class="hljs-comment">// Set fog parameters for volumetric lighting.</span><br>  <span class="hljs-keyword">var</span> visualEnv = VolumeManager.instance.stack.GetComponent&lt;VisualEnvironment&gt;();<br>  visualEnv.PushFogShaderParameters(hdCamera, cmd);<br>&#125;<br><br><span class="hljs-comment">// 体素化阶段</span><br>m_VolumetricLightingSystem.VolumeVoxelizationPass(hdCamera, cmd, m_FrameCount, densityVolumes);<br><br><span class="hljs-comment">// 渲染体积光</span><br>m_VolumetricLightingSystem.VolumetricLightingPass(hdCamera, cmd, m_FrameCount);<br><br><span class="hljs-comment">// 渲染延迟光照</span><br>RenderDeferredLighting(hdCamera, cmd);<br><br><span class="hljs-comment">// Might float this higher if we enable stereo w/ deferred</span><br>StartStereoRendering(renderContext, hdCamera);<br><br><span class="hljs-comment">// 渲染前向物体</span><br>RenderForward(m_CullResults, hdCamera, renderContext, cmd, ForwardPass.Opaque);<br><br><span class="hljs-comment">// SSS pass here handle both SSS material from deferred and forward</span><br>m_SSSBufferManager.SubsurfaceScatteringPass(hdCamera, cmd, diffusionProfileSettings,m_CameraColorBuffer, m_CameraSssDiffuseLightingBuffer, m_CameraDepthStencilBuffer, GetDepthTexture());<br><br><span class="hljs-comment">// 渲染天空</span><br>RenderSky(hdCamera, cmd);<br><br><span class="hljs-comment">// 渲染每一个反射物体</span><br>RenderForward(m_CullResults, hdCamera, renderContext, cmd, ForwardPass.PreRefraction);<br><br><span class="hljs-comment">// 渲染颜色金字塔</span><br>RenderColorPyramid(hdCamera, cmd, renderContext, <span class="hljs-literal">true</span>);<br><br><span class="hljs-comment">// 渲染前向物体</span><br><span class="hljs-comment">// Render all type of transparent forward (unlit, lit, complex (hair...)) to keep the sorting between transparent objects.</span><br>RenderForward(m_CullResults, hdCamera, renderContext, cmd, ForwardPass.Transparent);<br><br><span class="hljs-comment">// 渲染错误</span><br><span class="hljs-comment">// Render All forward error</span><br>RenderForwardError(m_CullResults, hdCamera, renderContext, cmd);<br><br><span class="hljs-comment">// Fill depth buffer to reduce artifact for transparent object during postprocess</span><br><span class="hljs-comment">// 给后处理渲染透明物体的深度</span><br>RenderTransparentDepthPostpass(m_CullResults, hdCamera, renderContext, cmd, ForwardPass.Transparent);<br><br><span class="hljs-comment">// 渲染颜色金字塔2</span><br>RenderColorPyramid(hdCamera, cmd, renderContext, <span class="hljs-literal">false</span>);<br><br><span class="hljs-comment">// ？？</span><br>AccumulateDistortion(m_CullResults, hdCamera, renderContext, cmd);<br>RenderDistortion(hdCamera, cmd, m_Asset.renderPipelineResources);<br><br>StopStereoRendering(renderContext, hdCamera);<br><br><span class="hljs-comment">// 测设相关</span><br>PushFullScreenDebugTexture(hdCamera, cmd, m_CameraColorBuffer, FullScreenDebugMode.NanTracker);<br>PushColorPickerDebugTexture(hdCamera, cmd, m_CameraColorBuffer);<br><br>StartStereoRendering(renderContext, hdCamera);<br><br><span class="hljs-comment">// 后处理</span><br><span class="hljs-comment">// Final blit</span><br><span class="hljs-keyword">if</span> (hdCamera.frameSettings.enablePostprocess)<br>&#123;<br>  RenderPostProcess(hdCamera, cmd, postProcessLayer);<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>  <span class="hljs-keyword">using</span> (<span class="hljs-keyword">new</span> ProfilingSample(cmd, <span class="hljs-string">&quot;Blit to final RT&quot;</span>, CustomSamplerId.BlitToFinalRT.GetSampler()))<br>  &#123;<br>    <span class="hljs-comment">// This Blit will flip the screen on anything other than openGL</span><br>    HDUtils.BlitCameraTexture(cmd, hdCamera, m_CameraColorBuffer, BuiltinRenderTextureType.CameraTarget);<br>  &#125;<br>&#125;<br><br>StopStereoRendering(renderContext, hdCamera);<br><span class="hljs-comment">// Pushes to XR headset and/or display mirror</span><br><span class="hljs-keyword">if</span> (hdCamera.frameSettings.enableStereo)<br>  renderContext.StereoEndRender(hdCamera.camera);<br></code></pre></td></tr></table></figure>



<h1 id="具体渲染方法"><a href="#具体渲染方法" class="headerlink" title="具体渲染方法"></a>具体渲染方法</h1><h2 id="RenderDepthPrepass"><a href="#RenderDepthPrepass" class="headerlink" title="RenderDepthPrepass"></a>RenderDepthPrepass</h2><p>渲染内容：根据渲染设置提前渲染深度。</p>
<p><strong>在Deferred渲染过程中，我们可以使用Forward不透明材质，这些材质需要渲染深度，来得到正确的灯光列表</strong></p>
<p><strong>之后再Deferred光照阶段（deferred lighting pass），不去渲染这些forward的不透明材质。</strong></p>
<p>在deferred模式下，默认是没有forward不透明物体的。但是如果有了，就需要ForwardOnly强行渲染不透明物体。这时候Forward没用，只有FOrwardOnly有用。同时也需要有DepthForwardOnly。</p>
<p>如果forward材质没有深度，则光照可能不正确。</p>
<p>  &#x2F;&#x2F; Forward material always output normal buffer (unless they don’t participate to shading)</p>
<p>&#x2F;&#x2F; Deferred material never output normal buffer</p>
<figure class="hljs highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs c#"><span class="hljs-comment">//Asset当中开启了Forward Only，则只会渲染前向物体。则depthonly 和depthforwardonly都会渲染。</span><br><span class="hljs-keyword">if</span> (hdCamera.frameSettings.enableForwardRenderingOnly)<br>&#123;<br>  HDUtils.SetRenderTarget 设置渲染目标<br>  <span class="hljs-comment">// Full forward: Output normal buffer for both forward and forwardOnly</span><br> RenderOpaqueRenderList(cull, <span class="hljs-comment">// 剪裁结果保存了所有Render</span><br>                        hdCamera, <span class="hljs-comment">//摄像机参数</span><br>                        renderContext,  <span class="hljs-comment">// 渲染上下文</span><br>                        cmd, <br>                        <span class="hljs-comment">// 需要渲染的pass ，所有深度pass都会渲染</span><br>                        m_DepthOnlyAndDepthForwardOnlyPassNames,<br>                        <span class="hljs-number">0</span>, <br>                        <span class="hljs-comment">// 渲染队列</span><br>                        HDRenderQueue.k_RenderQueue_AllOpaque);<br>&#125;<br><span class="hljs-comment">// 如果是deferred render的物体（也就是没有开启Forward Only设置）开启了DepthPrepass,或者开启了深度DBuffer，就会给Deferred渲染的物体也进行prepass深度渲染，一般主需要渲染forward的深度就可以。</span><br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (hdCamera.frameSettings.enableDepthPrepassWithDeferredRendering || m_DbufferManager.EnableDBUffer)<br>&#123;<br>  HDUtils.SetRenderTarget(cmd, hdCamera, m_CameraDepthStencilBuffer);<br>  <span class="hljs-comment">// 用DepthOnly写入deferred的深度</span><br>  RenderOpaqueRenderList(cull, hdCamera, renderContext, cmd, m_DepthOnlyPassNames, <span class="hljs-number">0</span>, HDRenderQueue.k_RenderQueue_AllOpaque);<br><br>  	<span class="hljs-comment">//与上面不同的是颜色缓存使用了法线 RTI（rendertexture index）也就是forward物体需要填充法线纹理。</span><br>  HDUtils.SetRenderTarget(cmd, hdCamera, <br>                          m_NormalBufferManager.GetBuffersRTI(),<br>                          m_CameraDepthStencilBuffer);<br><br>  <span class="hljs-comment">// 用DepthForwardOnly写入Forward物体的深度</span><br>  RenderOpaqueRenderList(cull, hdCamera, renderContext, cmd, m_DepthForwardOnlyPassNames, <span class="hljs-number">0</span>, HDRenderQueue.k_RenderQueue_AllOpaque);<br><br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-comment">// Deferred with partial depth prepass</span><br>&#123;<br>  cmd.DisableShaderKeyword(<span class="hljs-string">&quot;WRITE_NORMAL_BUFFER&quot;</span>);<br><span class="hljs-comment">// 给Deferred alpha tested materials必须渲染prepass。</span><br>  HDUtils.SetRenderTarget(cmd, hdCamera, m_CameraDepthStencilBuffer);<br>  <span class="hljs-keyword">var</span> renderQueueRange = <span class="hljs-keyword">new</span> RenderQueueRange &#123; min = (<span class="hljs-built_in">int</span>)RenderQueue.AlphaTest, max = (<span class="hljs-built_in">int</span>)RenderQueue.GeometryLast - <span class="hljs-number">1</span> &#125;;<br>  RenderOpaqueRenderList(cull, hdCamera, renderContext, cmd, m_DepthOnlyPassNames, <span class="hljs-number">0</span>, renderQueueRange);<br><br>  HDUtils.SetRenderTarget(cmd, hdCamera, m_NormalBufferManager.GetBuffersRTI(), m_CameraDepthStencilBuffer);<br><span class="hljs-comment">// 在deferred 模式下强行渲染Forward不透明物体，需要有DepthForwardonlyPath，否则光照错误。</span><br>  RenderOpaqueRenderList(cull, hdCamera, renderContext, cmd, m_DepthForwardOnlyPassNames, <span class="hljs-number">0</span>, HDRenderQueue.k_RenderQueue_AllOpaque);<br><br>&#125;<br><br><span class="hljs-comment">// 透明物体的Prepass</span><br><span class="hljs-keyword">if</span> (hdCamera.frameSettings.enableTransparentPrepass)<br>&#123;<br>	RenderTransparentRenderList(cull, hdCamera, <br>                                renderContext, <br>                                cmd, <br>                                m_TransparentDepthPrepassNames);<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="RenderDBuffer"><a href="#RenderDBuffer" class="headerlink" title="RenderDBuffer"></a>RenderDBuffer</h2><p>如果需要深度贴图则绑定一个DBuffer，需要接受Decal的也在这里渲染</p>
<figure class="hljs highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs c#"><span class="hljs-comment">//如果开启Dbuffer</span><br><span class="hljs-keyword">if</span> (!hdCamera.frameSettings.enableDBuffer)<br>  <span class="hljs-keyword">return</span>;<br><br><br>  <span class="hljs-comment">// We need to copy depth buffer texture if we want to bind it at this stage</span><br><span class="hljs-comment">// 复制了一份CameraDepthStencil</span><br>  CopyDepthBufferIfNeeded(cmd);<br><br>  <span class="hljs-comment">// Depth texture is now ready, bind it. 把复制得到的深度设置成全局深度</span><br><span class="hljs-comment">// _CameraDepthTexture在这里生产</span><br>  cmd.SetGlobalTexture(HDShaderIDs._CameraDepthTexture, GetDepthTexture());<br>  m_DbufferManager.ClearTargets(cmd, hdCamera);<br>  HDUtils.SetRenderTarget(cmd, hdCamera, m_DbufferManager.GetBuffersRTI(), m_CameraDepthStencilBuffer); <span class="hljs-comment">// do not clear anymore</span><br>  m_DbufferManager.SetHTile(m_DbufferManager.bufferCount, cmd);<br>  renderContext.ExecuteCommandBuffer(cmd);<br>  cmd.Clear();<br><br><span class="hljs-comment">// 渲染空pass  绘制DBufferMesh Pass decal？</span><br><span class="hljs-comment">// 使用——MeshDecalsPass 渲染一个_DecalHTileTexture纹理</span><br>  DrawRendererSettings drawSettings = <span class="hljs-keyword">new</span> DrawRendererSettings(hdCamera.camera, HDShaderPassNames.s_EmptyName)<br>  &#123;<br>    rendererConfiguration = <span class="hljs-number">0</span>,<br>    sorting = &#123; flags = SortFlags.CommonOpaque &#125;<br>  &#125;;<br>  drawSettings.SetShaderPassName(<span class="hljs-number">0</span>, HDShaderPassNames.s_MeshDecalsName);<br>  FilterRenderersSettings filterRenderersSettings = <span class="hljs-keyword">new</span> FilterRenderersSettings(<span class="hljs-literal">true</span>)<br>  &#123;<br>    renderQueueRange = HDRenderQueue.k_RenderQueue_AllOpaque<br>  &#125;;<br><span class="hljs-comment">// 渲染需要接受decal的物体</span><br>  renderContext.DrawRenderers(cullResults.visibleRenderers, <span class="hljs-keyword">ref</span> drawSettings, filterRenderersSettings);<br><br><span class="hljs-comment">// 渲染Decal到Dbuffer  HtileDepth？</span><br>  DecalSystem.instance.RenderIntoDBuffer(cmd);<br>  m_DbufferManager.UnSetHTile(cmd);<br>  m_DbufferManager.SetHTileTexture(cmd);  <span class="hljs-comment">// mask per 8x8 tile used for optimization when looking up dbuffer values</span><br><br></code></pre></td></tr></table></figure>



<h2 id="RenderGBuffer"><a href="#RenderGBuffer" class="headerlink" title="RenderGBuffer"></a>RenderGBuffer</h2><figure class="hljs highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c#"><span class="hljs-comment">// 只渲染前向物体</span><br><span class="hljs-keyword">if</span> (hdCamera.frameSettings.enableForwardRenderingOnly)<br>  <span class="hljs-keyword">return</span>;<br><span class="hljs-comment">// 设置Gbuffer目标，和深度</span><br>HDUtils.SetRenderTarget(cmd, hdCamera, m_GbufferManager.GetBuffersRTI(enableShadowMask), m_CameraDepthStencilBuffer);<br><span class="hljs-comment">// 进行渲染，渲染的过程填充深度</span><br>RenderOpaqueRenderList(cull, hdCamera, renderContext, cmd, HDShaderPassNames.s_GBufferName, m_currentRendererConfigurationBakedLighting, HDRenderQueue.k_RenderQueue_AllOpaque);<br><span class="hljs-comment">// 设置Gbuffer _GBufferTexture0 - 4</span><br>m_GbufferManager.BindBufferAsTextures(cmd);<br></code></pre></td></tr></table></figure>



<h2 id="RenderDepthPyramid"><a href="#RenderDepthPyramid" class="headerlink" title="RenderDepthPyramid"></a>RenderDepthPyramid</h2><p>computeShader计算深度金字塔</p>
<h2 id="RenderObjectsVelocity"><a href="#RenderObjectsVelocity" class="headerlink" title="RenderObjectsVelocity"></a>RenderObjectsVelocity</h2><p>渲染物体速度			</p>
<h2 id="RenderCameraVelocity"><a href="#RenderCameraVelocity" class="headerlink" title="RenderCameraVelocity"></a>RenderCameraVelocity</h2><p>渲染摄像机速度</p>
<p>##cmd.SetGlobalTexture();</p>
<p>设置全局深度贴图</p>
<h2 id="RenderSSAO"><a href="#RenderSSAO" class="headerlink" title="RenderSSAO"></a>RenderSSAO</h2><p>SSAO, Shadow, Build light list, deferred shadow, material and light classification can be parallelize with Async compute</p>
<p>同时计算各种效果</p>
<h2 id="m-VolumetricLightingSystem"><a href="#m-VolumetricLightingSystem" class="headerlink" title="m_VolumetricLightingSystem"></a>m_VolumetricLightingSystem</h2><p>和体积光相关的操作</p>
<h2 id="m-LightLoop-RenderShadows"><a href="#m-LightLoop-RenderShadows" class="headerlink" title="m_LightLoop.RenderShadows"></a>m_LightLoop.RenderShadows</h2><p>渲染阴影</p>
<h2 id="m-LightLoop-RenderDeferredDirectionalShadow"><a href="#m-LightLoop-RenderDeferredDirectionalShadow" class="headerlink" title="m_LightLoop.RenderDeferredDirectionalShadow"></a>m_LightLoop.RenderDeferredDirectionalShadow</h2><h2 id="RenderDeferredLighting"><a href="#RenderDeferredLighting" class="headerlink" title="RenderDeferredLighting"></a>RenderDeferredLighting</h2><p>计算deferred物体光照 </p>
<p>实现了ComputeShader和Shader两个版本的Deferred计算。</p>
<h2 id="RenderForward"><a href="#RenderForward" class="headerlink" title="RenderForward"></a>RenderForward</h2><p>ForwardPass.Opaque Pass</p>
<p>在不同模式下的渲染：</p>
<p>在RenderForward的过程中，渲染那个pass会根据设置不同发生改变。</p>
<p>如果启用ForwardOnly Rnedering，那么Forward和ForwardOnly就都会渲染，无论是不透明物体还是透明物体。</p>
<p>如果是Deferred模式，那么对于transparent Forward和ForwardOnly就都会渲染，对于opaque就只会渲染ForwardOnly。</p>
<p>所以ForwardOnly 和Forward是互斥的。</p>
<figure class="hljs highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs c#"><span class="hljs-comment">// Debug相关内容</span><br><span class="hljs-built_in">string</span> profileName;<br><span class="hljs-keyword">if</span> (m_CurrentDebugDisplaySettings.IsDebugDisplayEnabled())<br>&#123;<br>  profileName = k_ForwardPassDebugName[(<span class="hljs-built_in">int</span>)pass];<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>  profileName = k_ForwardPassName[(<span class="hljs-built_in">int</span>)pass];<br>&#125;<br><br><br><span class="hljs-comment">// 获取摄像机</span><br><span class="hljs-keyword">var</span> camera = hdCamera.camera;<br><br><span class="hljs-comment">// ???????</span><br>m_LightLoop.RenderForward(camera, cmd, pass == ForwardPass.Opaque);<br><br><span class="hljs-comment">// 屏幕空间Tracing</span><br><span class="hljs-keyword">var</span> debugScreenSpaceTracing = m_CurrentDebugDisplaySettings.fullScreenDebugMode == FullScreenDebugMode.ScreenSpaceTracing;<br><br><span class="hljs-comment">// 不透明物体</span><br><span class="hljs-keyword">if</span> (pass == ForwardPass.Opaque)<br>&#123;<br>  <span class="hljs-comment">// 使用SSS效果</span><br>  <span class="hljs-keyword">if</span> (hdCamera.frameSettings.enableSubsurfaceScattering)<br>  &#123;<br>    RenderTargetIdentifier[] m_MRTWithSSS = <span class="hljs-keyword">new</span> RenderTargetIdentifier[<span class="hljs-number">2</span> + m_SSSBufferManager.sssBufferCount];<br>    <span class="hljs-comment">// 准备所有的SSS需要的buffer</span><br>    m_MRTWithSSS[<span class="hljs-number">0</span>] = m_CameraColorBuffer; <span class="hljs-comment">// Store the specular color</span><br>    m_MRTWithSSS[<span class="hljs-number">1</span>] = m_CameraSssDiffuseLightingBuffer;<br>    <br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; m_SSSBufferManager.sssBufferCount; ++i)<br>    &#123;<br>      m_MRTWithSSS[i + <span class="hljs-number">2</span>] = m_SSSBufferManager.GetSSSBuffer(i);<br>    &#125;<br><br>    HDUtils.SetRenderTarget(cmd, hdCamera, m_MRTWithSSS, m_CameraDepthStencilBuffer);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>	<span class="hljs-comment">//不使用SSS效果，则就是用一般的Depth和COlorbuffer</span><br>    HDUtils.SetRenderTarget(cmd, hdCamera, m_CameraColorBuffer, m_CameraDepthStencilBuffer);<br>  &#125;<br><br>  <span class="hljs-comment">//根据渲染设置使用不同的Forwardpass  ： ForwardOnly Or Forward</span><br>  <span class="hljs-keyword">var</span> passNames = hdCamera.frameSettings.enableForwardRenderingOnly<br>    ? m_ForwardAndForwardOnlyPassNames<br>    : m_ForwardOnlyPassNames;<br>  <span class="hljs-comment">// 调试模式</span><br>  <span class="hljs-keyword">var</span> debugSSTThisPass = debugScreenSpaceTracing &amp;&amp; (m_CurrentDebugDisplaySettings.lightingDebugSettings.debugLightingMode == DebugLightingMode.ScreenSpaceTracingReflection);<br><br>  <span class="hljs-keyword">if</span> (debugSSTThisPass)<br>    cmd.SetRandomWriteTarget(<span class="hljs-number">7</span>, m_DebugScreenSpaceTracingData);<br>  <br>  <span class="hljs-comment">// 渲染不透明物体</span><br>  RenderOpaqueRenderList(cullResults, hdCamera, renderContext, cmd, passNames, m_currentRendererConfigurationBakedLighting);<br>  <br>  <span class="hljs-keyword">if</span> (debugSSTThisPass)<br>    cmd.ClearRandomWriteTargets();<br>&#125;<br><span class="hljs-comment">//渲染透明物体</span><br><span class="hljs-keyword">else</span><br>&#123;<br>  <span class="hljs-comment">// 设置透明物体渲染目标</span><br>  HDUtils.SetRenderTarget(cmd, hdCamera, m_CameraColorBuffer, m_CameraDepthStencilBuffer);<br>  <span class="hljs-comment">// 使用dbuffer 并且有Decal 则SetAtlas？？？？</span><br>  <span class="hljs-keyword">if</span> ((hdCamera.frameSettings.enableDBuffer) &amp;&amp; (DecalSystem.m_DecalDatasCount &gt; <span class="hljs-number">0</span>)) <br>  &#123;<br>    DecalSystem.instance.SetAtlas(cmd); <span class="hljs-comment">// for clustered decals</span><br>  &#125;<br><br>  <span class="hljs-keyword">var</span> debugSSTThisPass = debugScreenSpaceTracing &amp;&amp; (m_CurrentDebugDisplaySettings.lightingDebugSettings.debugLightingMode == DebugLightingMode.ScreenSpaceTracingRefraction);<br>  <span class="hljs-keyword">if</span> (debugSSTThisPass)<br>    cmd.SetRandomWriteTarget(<span class="hljs-number">7</span>, m_DebugScreenSpaceTracingData);<br>  <br>  <span class="hljs-comment">// 渲染透明物体</span><br>  RenderTransparentRenderList(cullResults, hdCamera, renderContext, cmd, m_AllTransparentPassNames, m_currentRendererConfigurationBakedLighting, pass == ForwardPass.PreRefraction ? HDRenderQueue.k_RenderQueue_PreRefraction : HDRenderQueue.k_RenderQueue_Transparent);<br>  <br>  <span class="hljs-keyword">if</span> (debugSSTThisPass)<br>    cmd.ClearRandomWriteTargets();<br>&#125;<br><br></code></pre></td></tr></table></figure>

<figure class="hljs highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//渲染的ShaderPass</span><br>   var passNames = hdCamera.frameSettings.enableForwardRenderingOnly<br>                        ? m_ForwardAndForwardOnlyPassNames<br>                        : m_ForwardOnlyPassNames;<br><br><span class="hljs-comment">// HDShaderPassNames.s_SRPDefaultUnlitName  是一个FallBack</span><br>ShaderPassName[] m_ForwardAndForwardOnlyPassNames = &#123; HDShaderPassNames.s_ForwardOnlyName, <br>                                                     HDShaderPassNames.s_ForwardName, <br>                                                     HDShaderPassNames.s_SRPDefaultUnlitName &#125;;<br>ShaderPassName[] m_ForwardOnlyPassNames = &#123; HDShaderPassNames.s_ForwardOnlyName, <br>                                           HDShaderPassNames.s_SRPDefaultUnlitName &#125;;<br><br><span class="hljs-comment">// 渲染队列</span><br>RenderQueueRange k_RenderQueue_AllOpaque = new RenderQueueRange &#123; <br>  min = (<span class="hljs-type">int</span>)Priority.Opaque,    <span class="hljs-number">2000</span><br>  max = (<span class="hljs-type">int</span>)Priority.OpaqueLast &#125;; <span class="hljs-number">2500</span><br></code></pre></td></tr></table></figure>



<h2 id="RenderSky"><a href="#RenderSky" class="headerlink" title="RenderSky"></a>RenderSky</h2><h2 id="RenderForward-1"><a href="#RenderForward-1" class="headerlink" title="RenderForward"></a>RenderForward</h2><p>forwardPass.PreRefraction Pass</p>
<figure class="hljs highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c#"><span class="hljs-comment">//渲染的pass</span><br>ShaderPassName[] m_AllTransparentPassNames = &#123;  HDShaderPassNames.s_TransparentBackfaceName,<br>                                                        HDShaderPassNames.s_ForwardOnlyName,<br>                                                        HDShaderPassNames.s_ForwardName,<br>                                                        HDShaderPassNames.s_SRPDefaultUnlitName &#125;;<br><span class="hljs-comment">// 渲染队列</span><br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> RenderQueueRange k_RenderQueue_Transparent = <span class="hljs-keyword">new</span> RenderQueueRange &#123; <br>   min = (<span class="hljs-built_in">int</span>)Priority.PreRefractionFirst,  <span class="hljs-number">2750</span> - <span class="hljs-number">100</span><br>   max = (<span class="hljs-built_in">int</span>)Priority.PreRefractionLast &#125;; <span class="hljs-number">2750</span> + <span class="hljs-number">100</span><br></code></pre></td></tr></table></figure>





<h2 id="RenderColorPyramid"><a href="#RenderColorPyramid" class="headerlink" title="RenderColorPyramid"></a>RenderColorPyramid</h2><p>Gpu计算,会根据是否需要Bloom，Distortion，SSR等内容来判断是否使用。</p>
<figure class="hljs highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c#">RenderColorPyramid(hdCamera, cmd, renderContext, <span class="hljs-literal">true</span>);<br></code></pre></td></tr></table></figure>





<h2 id="RenderForward-2"><a href="#RenderForward-2" class="headerlink" title="RenderForward"></a>RenderForward</h2><p>ForwardPass.Transparent Pass</p>
<figure class="hljs highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c">ShaderPassName[] m_AllTransparentPassNames = &#123;  							HDShaderPassNames.s_TransparentBackfaceName,<br>                                                        HDShaderPassNames.s_ForwardOnlyName,<br>                                                        HDShaderPassNames.s_ForwardName,<br>                                                        HDShaderPassNames.s_SRPDefaultUnlitName &#125;;<br><br><span class="hljs-comment">//渲染队列</span><br> public <span class="hljs-type">static</span> readonly RenderQueueRange k_RenderQueue_PreRefraction = new RenderQueueRange &#123; min = (<span class="hljs-type">int</span>)Priority.TransparentFirst,     <span class="hljs-number">3000</span> - <span class="hljs-number">100</span><br>max = (<span class="hljs-type">int</span>)Priority. TransparentLast&#125;;    <span class="hljs-number">3000</span> + <span class="hljs-number">100</span><br></code></pre></td></tr></table></figure>

<p>##RednerTransparentDepthPostpass</p>
<figure class="hljs highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c#"><span class="hljs-keyword">if</span> (!hdCamera.frameSettings.enableTransparentPostpass)<br><span class="hljs-keyword">return</span>;<br><br><br>HDUtils.SetRenderTarget(cmd, hdCamera, m_CameraDepthStencilBuffer);<br>RenderTransparentRenderList(cullResults, hdCamera, renderContext, cmd, m_TransparentDepthPostpassNames);<br><br><span class="hljs-comment">//使用Pass</span><br>TransparentDepthPostpass<br></code></pre></td></tr></table></figure>
<p>##RenderColorPyramid</p>
<figure class="hljs highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c#">RenderColorPyramid(hdCamera, cmd, renderContext, <span class="hljs-literal">false</span>); <br></code></pre></td></tr></table></figure>



<h2 id="渲染错误的Pass"><a href="#渲染错误的Pass" class="headerlink" title="渲染错误的Pass"></a>渲染错误的Pass</h2><p>都是之前遗留的PassName</p>
<pre><code>    public static readonly ShaderPassName s_AlwaysName = new ShaderPassName(&quot;Always&quot;);
    public static readonly ShaderPassName s_ForwardBaseName = new ShaderPassName(&quot;ForwardBase&quot;);
    public static readonly ShaderPassName s_DeferredName = new ShaderPassName(&quot;Deferred&quot;);
    public static readonly ShaderPassName s_PrepassBaseName = new ShaderPassName(&quot;PrepassBase&quot;);
    public static readonly ShaderPassName s_VertexName = new ShaderPassName(&quot;Vertex&quot;);
    public static readonly ShaderPassName s_VertexLMRGBMName = new ShaderPassName(&quot;VertexLMRGBM&quot;);
    public static readonly ShaderPassName s_VertexLMName = new ShaderPassName(&quot;VertexLM&quot;);
</code></pre>
<h2 id="AccumulateDistortion-amp-RenderDistortion"><a href="#AccumulateDistortion-amp-RenderDistortion" class="headerlink" title="AccumulateDistortion &amp; RenderDistortion"></a>AccumulateDistortion &amp; RenderDistortion</h2><p>失真计算？</p>
<h2 id="RenderPostProcess"><a href="#RenderPostProcess" class="headerlink" title="RenderPostProcess"></a>RenderPostProcess</h2><p>后处理</p>
<h2 id="进一步调用"><a href="#进一步调用" class="headerlink" title="进一步调用"></a>进一步调用</h2><h3 id="RenderOpaqueRenderList"><a href="#RenderOpaqueRenderList" class="headerlink" title="RenderOpaqueRenderList"></a>RenderOpaqueRenderList</h3><figure class="hljs highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c#"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">RenderTransparentRenderList</span>(<span class="hljs-params">CullResults cull,</span></span><br><span class="hljs-params"><span class="hljs-function">            HDCamera hdCamera,</span></span><br><span class="hljs-params"><span class="hljs-function">            ScriptableRenderContext renderContext,</span></span><br><span class="hljs-params"><span class="hljs-function">            CommandBuffer cmd,</span></span><br><span class="hljs-params"><span class="hljs-function">            ShaderPassName passName,</span></span><br><span class="hljs-params"><span class="hljs-function">            RendererConfiguration rendererConfiguration = <span class="hljs-number">0</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">            RenderQueueRange? inRenderQueueRange = <span class="hljs-literal">null</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">            RenderStateBlock? stateBlock = <span class="hljs-literal">null</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">            Material overrideMaterial = <span class="hljs-literal">null</span></span></span><br><span class="hljs-params"><span class="hljs-function">                                 </span></span><br><span class="hljs-params"><span class="hljs-function"><span class="hljs-keyword">void</span> RenderTransparentRenderList(CullResults cull,</span></span><br><span class="hljs-params"><span class="hljs-function">            HDCamera hdCamera,</span></span><br><span class="hljs-params"><span class="hljs-function">            ScriptableRenderContext renderContext,</span></span><br><span class="hljs-params"><span class="hljs-function">            CommandBuffer cmd, </span></span><br><span class="hljs-params"><span class="hljs-function">            ShaderPassName[] passName,   //  多个pass</span></span><br><span class="hljs-params"><span class="hljs-function">            RendererConfiguration rendererConfiguration = <span class="hljs-number">0</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">            RenderQueueRange? inRenderQueueRange = <span class="hljs-literal">null</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">            RenderStateBlock? stateBlock = <span class="hljs-literal">null</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">            Material overrideMaterial = <span class="hljs-literal">null</span></span></span><br></code></pre></td></tr></table></figure>

<figure class="hljs highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs c#"><span class="hljs-comment">// 想要渲染不都名物体 </span><br><span class="hljs-keyword">if</span> (!hdCamera.frameSettings.enableOpaqueObjects)<br>     <span class="hljs-keyword">return</span>;<br><span class="hljs-comment">// DrawRender 不再Command当中渲染，所以想把之前的做完。</span><br>renderContext.ExecuteCommandBuffer(cmd);<br>cmd.Clear();<br><br><span class="hljs-comment">// 设置绘制参数，排序方式</span><br><span class="hljs-keyword">var</span> drawSettings = <span class="hljs-keyword">new</span> DrawRendererSettings(hdCamera.camera, HDShaderPassNames.s_EmptyName)<br>&#123;<br>  rendererConfiguration = rendererConfiguration,<br>  sorting = &#123; flags = SortFlags.CommonOpaque &#125;<br>&#125;;<br><br><span class="hljs-comment">// 收集需要渲染的pass Name</span><br><span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; passNames.Length; ++i)<br>&#123;<br>  drawSettings.SetShaderPassName(i, passNames[i]);<br>&#125;<br><br><span class="hljs-comment">// 设置全局材质，渲染某些通用效果的时候使用</span><br><span class="hljs-keyword">if</span> (overrideMaterial != <span class="hljs-literal">null</span>)<br>  drawSettings.SetOverrideMaterial(overrideMaterial, <span class="hljs-number">0</span>);<br><br><span class="hljs-comment">// 渲染队列，指定还是范围</span><br><span class="hljs-keyword">var</span> filterSettings = <span class="hljs-keyword">new</span> FilterRenderersSettings(<span class="hljs-literal">true</span>)<br>&#123;<br>  renderQueueRange = inRenderQueueRange == <span class="hljs-literal">null</span> ? <br>    HDRenderQueue.k_RenderQueue_AllOpaque : inRenderQueueRange.Value<br>      <span class="hljs-comment">//2000 -  2500</span><br>&#125;;<br><br><span class="hljs-keyword">if</span> (stateBlock == <span class="hljs-literal">null</span>)<br>  renderContext.DrawRenderers(cull.visibleRenderers, <span class="hljs-keyword">ref</span> drawSettings, filterSettings);<br><span class="hljs-keyword">else</span><br>  renderContext.DrawRenderers(cull.visibleRenderers, <span class="hljs-keyword">ref</span> drawSettings, filterSettings, stateBlock.Value);<br></code></pre></td></tr></table></figure>



<p>###RenderTransparentRenderList</p>
<h1 id="初始化与HDRenderPipelineAsset"><a href="#初始化与HDRenderPipelineAsset" class="headerlink" title="初始化与HDRenderPipelineAsset"></a>初始化与HDRenderPipelineAsset</h1>
      
      <p align="right"><a class="morebtn" href="/2022/07/09/HDRPsource/1.%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84/" title="代码结构">阅读全文</a></p>
    </main>
    <footer class="post-footer">
      
    </footer>
  </article>
  
  <article class="article post card animate" itemscope itemtype="http://schema.org/Article">
    <div class="post-block">
      <link itemprop="mainEntityOfPage" href="http://leinlin.github.io/2022/07/09/HDRPsource/3.%E6%B8%B2%E6%9F%93%E5%8F%82%E6%95%B0/">
      <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
        <meta itemprop="name" content="leinlin">
        <meta itemprop="description" content="">
        <meta itemprop="image" content="/images/avatar.jpg">
      </span>
      <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
        <meta itemprop="name" content="leinlin的小笔记">
      </span>
    </div>
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link post-title-link-external" href="/2022/07/09/HDRPsource/3.%E6%B8%B2%E6%9F%93%E5%8F%82%E6%95%B0/" itemprop="url">渲染队列</a>
      </h1>
      <div class="post-meta">
        
        <span class="post-date">
          <i class="far fa-calendar-plus"></i><span><time title="post-date" itemprop="dateCreated datePublished" datetime="2022-07-09T12:00:14+08:00">2022-07-09 12:00:14</time></span>
        </span>
        
        
        
        <span class="post-meta-divider divider">|</span>
        
        <span class="post-categories">
          
          <i class="far fa-folder-open"></i><span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/HDRPSource/" itemprop="url" rel="index"><span itemprop="name">HDRPSource</span></a></span>
        </span>
        
        
        
        
      </div>
    </header>
    <main class="post-main" itemprop="articleBody">
      
      <p>#.渲染队列</p>
<figure class="hljs highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c#"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">HDRenderQueue</span><br>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> k_TransparentPriorityQueueRange = <span class="hljs-number">100</span>;<br><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">enum</span> Priority<br>&#123;<br>Background = UnityEngine.Rendering.RenderQueue.Background,<br>Opaque = UnityEngine.Rendering.RenderQueue.Geometry,<br>OpaqueAlphaTest = UnityEngine.Rendering.RenderQueue.AlphaTest,<br><span class="hljs-comment">// Warning: we must not change Geometry last value to stay compatible with occlusion</span><br>OpaqueLast = UnityEngine.Rendering.RenderQueue.GeometryLast,<br><span class="hljs-comment">// For transparent pass we define a range of 200 value to define the priority</span><br><span class="hljs-comment">// Warning: Be sure no range are overlapping</span><br>PreRefractionFirst = <span class="hljs-number">2750</span> - k_TransparentPriorityQueueRange,<br>PreRefraction = <span class="hljs-number">2750</span>,<br>PreRefractionLast = <span class="hljs-number">2750</span> + k_TransparentPriorityQueueRange,<br>TransparentFirst = UnityEngine.Rendering.RenderQueue.Transparent - k_TransparentPriorityQueueRange,<br>Transparent = UnityEngine.Rendering.RenderQueue.Transparent,<br>TransparentLast = UnityEngine.Rendering.RenderQueue.Transparent + k_TransparentPriorityQueueRange,<br>Overlay = UnityEngine.Rendering.RenderQueue.Overlay<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> RenderQueueRange k_RenderQueue_OpaqueNoAlphaTest = <span class="hljs-keyword">new</span> RenderQueueRange &#123; min = (<span class="hljs-built_in">int</span>)Priority.Opaque, max = (<span class="hljs-built_in">int</span>)Priority.OpaqueAlphaTest - <span class="hljs-number">1</span> &#125;;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> RenderQueueRange k_RenderQueue_OpaqueAlphaTest = <span class="hljs-keyword">new</span> RenderQueueRange &#123; min = (<span class="hljs-built_in">int</span>)Priority.OpaqueAlphaTest, max = (<span class="hljs-built_in">int</span>)Priority.OpaqueLast &#125;;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> RenderQueueRange k_RenderQueue_AllOpaque = <span class="hljs-keyword">new</span> RenderQueueRange &#123; min = (<span class="hljs-built_in">int</span>)Priority.Opaque, max = (<span class="hljs-built_in">int</span>)Priority.OpaqueLast &#125;;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> RenderQueueRange k_RenderQueue_PreRefraction = <span class="hljs-keyword">new</span> RenderQueueRange &#123; min = (<span class="hljs-built_in">int</span>)Priority.PreRefractionFirst, max = (<span class="hljs-built_in">int</span>)Priority.PreRefractionLast &#125;;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> RenderQueueRange k_RenderQueue_Transparent = <span class="hljs-keyword">new</span> RenderQueueRange &#123; min = (<span class="hljs-built_in">int</span>)Priority.TransparentFirst, max = (<span class="hljs-built_in">int</span>)Priority.TransparentLast &#125;;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> RenderQueueRange k_RenderQueue_AllTransparent = <span class="hljs-keyword">new</span> RenderQueueRange &#123; min = (<span class="hljs-built_in">int</span>)Priority.PreRefractionFirst, max = (<span class="hljs-built_in">int</span>)Priority.TransparentLast &#125;;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> RenderQueueRange k_RenderQueue_All = <span class="hljs-keyword">new</span> RenderQueueRange &#123; min = <span class="hljs-number">0</span>, max = <span class="hljs-number">5000</span> &#125;;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>2内置纹理</p>
<figure class="hljs highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br></pre></td><td class="code"><pre><code class="hljs c#"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">HDShaderIDs</span><br>&#123;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ShadowDatasExp = Shader.PropertyToID(<span class="hljs-string">&quot;_ShadowDatasExp&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ShadowPayloads = Shader.PropertyToID(<span class="hljs-string">&quot;_ShadowPayloads&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ShadowmapExp_VSM_0 = Shader.PropertyToID(<span class="hljs-string">&quot;_ShadowmapExp_VSM_0&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ShadowmapExp_VSM_1 = Shader.PropertyToID(<span class="hljs-string">&quot;_ShadowmapExp_VSM_1&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ShadowmapExp_VSM_2 = Shader.PropertyToID(<span class="hljs-string">&quot;_ShadowmapExp_VSM_2&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ShadowmapExp_PCF = Shader.PropertyToID(<span class="hljs-string">&quot;_ShadowmapExp_PCF&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_LayeredSingleIdxBuffer = Shader.PropertyToID(<span class="hljs-string">&quot;g_LayeredSingleIdxBuffer&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _EnvLightIndexShift = Shader.PropertyToID(<span class="hljs-string">&quot;_EnvLightIndexShift&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DensityVolumeIndexShift = Shader.PropertyToID(<span class="hljs-string">&quot;_DensityVolumeIndexShift&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_isOrthographic = Shader.PropertyToID(<span class="hljs-string">&quot;g_isOrthographic&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_iNrVisibLights = Shader.PropertyToID(<span class="hljs-string">&quot;g_iNrVisibLights&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_mScrProjection = Shader.PropertyToID(<span class="hljs-string">&quot;g_mScrProjection&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_mInvScrProjection = Shader.PropertyToID(<span class="hljs-string">&quot;g_mInvScrProjection&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_mScrProjectionArr = Shader.PropertyToID(<span class="hljs-string">&quot;g_mScrProjectionArr&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_mInvScrProjectionArr = Shader.PropertyToID(<span class="hljs-string">&quot;g_mInvScrProjectionArr&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_iLog2NumClusters = Shader.PropertyToID(<span class="hljs-string">&quot;g_iLog2NumClusters&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_screenSize = Shader.PropertyToID(<span class="hljs-string">&quot;g_screenSize&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_iNumSamplesMSAA = Shader.PropertyToID(<span class="hljs-string">&quot;g_iNumSamplesMSAA&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_fNearPlane = Shader.PropertyToID(<span class="hljs-string">&quot;g_fNearPlane&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_fFarPlane = Shader.PropertyToID(<span class="hljs-string">&quot;g_fFarPlane&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_fClustScale = Shader.PropertyToID(<span class="hljs-string">&quot;g_fClustScale&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_fClustBase = Shader.PropertyToID(<span class="hljs-string">&quot;g_fClustBase&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_depth_tex = Shader.PropertyToID(<span class="hljs-string">&quot;g_depth_tex&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_vLayeredLightList = Shader.PropertyToID(<span class="hljs-string">&quot;g_vLayeredLightList&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_LayeredOffset = Shader.PropertyToID(<span class="hljs-string">&quot;g_LayeredOffset&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_vBigTileLightList = Shader.PropertyToID(<span class="hljs-string">&quot;g_vBigTileLightList&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_logBaseBuffer = Shader.PropertyToID(<span class="hljs-string">&quot;g_logBaseBuffer&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_vBoundsBuffer = Shader.PropertyToID(<span class="hljs-string">&quot;g_vBoundsBuffer&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _LightVolumeData = Shader.PropertyToID(<span class="hljs-string">&quot;_LightVolumeData&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_data = Shader.PropertyToID(<span class="hljs-string">&quot;g_data&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_mProjectionArr = Shader.PropertyToID(<span class="hljs-string">&quot;g_mProjectionArr&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_mInvProjectionArr = Shader.PropertyToID(<span class="hljs-string">&quot;g_mInvProjectionArr&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_viDimensions = Shader.PropertyToID(<span class="hljs-string">&quot;g_viDimensions&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_vLightList = Shader.PropertyToID(<span class="hljs-string">&quot;g_vLightList&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_BaseFeatureFlags = Shader.PropertyToID(<span class="hljs-string">&quot;g_BaseFeatureFlags&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_TileFeatureFlags = Shader.PropertyToID(<span class="hljs-string">&quot;g_TileFeatureFlags&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_DispatchIndirectBuffer = Shader.PropertyToID(<span class="hljs-string">&quot;g_DispatchIndirectBuffer&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_TileList = Shader.PropertyToID(<span class="hljs-string">&quot;g_TileList&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_NumTiles = Shader.PropertyToID(<span class="hljs-string">&quot;g_NumTiles&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_NumTilesX = Shader.PropertyToID(<span class="hljs-string">&quot;g_NumTilesX&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _NumTiles = Shader.PropertyToID(<span class="hljs-string">&quot;_NumTiles&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _CookieTextures = Shader.PropertyToID(<span class="hljs-string">&quot;_CookieTextures&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _CookieCubeTextures = Shader.PropertyToID(<span class="hljs-string">&quot;_CookieCubeTextures&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _EnvCubemapTextures = Shader.PropertyToID(<span class="hljs-string">&quot;_EnvCubemapTextures&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _Env2DTextures = Shader.PropertyToID(<span class="hljs-string">&quot;_Env2DTextures&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _Env2DCaptureVP = Shader.PropertyToID(<span class="hljs-string">&quot;_Env2DCaptureVP&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DirectionalLightDatas = Shader.PropertyToID(<span class="hljs-string">&quot;_DirectionalLightDatas&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DirectionalLightCount = Shader.PropertyToID(<span class="hljs-string">&quot;_DirectionalLightCount&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _LightDatas = Shader.PropertyToID(<span class="hljs-string">&quot;_LightDatas&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _PunctualLightCount = Shader.PropertyToID(<span class="hljs-string">&quot;_PunctualLightCount&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _AreaLightCount = Shader.PropertyToID(<span class="hljs-string">&quot;_AreaLightCount&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_vLightListGlobal = Shader.PropertyToID(<span class="hljs-string">&quot;g_vLightListGlobal&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _EnvLightDatas = Shader.PropertyToID(<span class="hljs-string">&quot;_EnvLightDatas&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _EnvLightCount = Shader.PropertyToID(<span class="hljs-string">&quot;_EnvLightCount&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _EnvProxyCount = Shader.PropertyToID(<span class="hljs-string">&quot;_EnvProxyCount&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ShadowDatas = Shader.PropertyToID(<span class="hljs-string">&quot;_ShadowDatas&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _NumTileFtplX = Shader.PropertyToID(<span class="hljs-string">&quot;_NumTileFtplX&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _NumTileFtplY = Shader.PropertyToID(<span class="hljs-string">&quot;_NumTileFtplY&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _NumTileClusteredX = Shader.PropertyToID(<span class="hljs-string">&quot;_NumTileClusteredX&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _NumTileClusteredY = Shader.PropertyToID(<span class="hljs-string">&quot;_NumTileClusteredY&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_isLogBaseBufferEnabled = Shader.PropertyToID(<span class="hljs-string">&quot;g_isLogBaseBufferEnabled&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_vLayeredOffsetsBuffer = Shader.PropertyToID(<span class="hljs-string">&quot;g_vLayeredOffsetsBuffer&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ViewTilesFlags = Shader.PropertyToID(<span class="hljs-string">&quot;_ViewTilesFlags&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _MousePixelCoord = Shader.PropertyToID(<span class="hljs-string">&quot;_MousePixelCoord&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _MouseClickPixelCoord = Shader.PropertyToID(<span class="hljs-string">&quot;_MouseClickPixelCoord&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DebugStep = Shader.PropertyToID(<span class="hljs-string">&quot;_DebugStep&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DebugFont = Shader.PropertyToID(<span class="hljs-string">&quot;_DebugFont&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DebugExposure = Shader.PropertyToID(<span class="hljs-string">&quot;_DebugExposure&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DebugScreenSpaceTracingData = Shader.PropertyToID(<span class="hljs-string">&quot;_DebugScreenSpaceTracingData&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ShowGrid = Shader.PropertyToID(<span class="hljs-string">&quot;_ShowGrid&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ShowSSRaySampledColor = Shader.PropertyToID(<span class="hljs-string">&quot;_ShowSSRaySampledColor&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ShowDepthPyramidDebug = Shader.PropertyToID(<span class="hljs-string">&quot;_ShowDepthPyramidDebug&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DebugViewMaterial = Shader.PropertyToID(<span class="hljs-string">&quot;_DebugViewMaterial&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DebugLightingMode = Shader.PropertyToID(<span class="hljs-string">&quot;_DebugLightingMode&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DebugLightingSubMode = Shader.PropertyToID(<span class="hljs-string">&quot;_DebugLightingSubMode&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DebugLightingAlbedo = Shader.PropertyToID(<span class="hljs-string">&quot;_DebugLightingAlbedo&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DebugLightingSmoothness = Shader.PropertyToID(<span class="hljs-string">&quot;_DebugLightingSmoothness&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DebugLightingNormal = Shader.PropertyToID(<span class="hljs-string">&quot;_DebugLightingNormal&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DebugLightingSpecularColor = Shader.PropertyToID(<span class="hljs-string">&quot;_DebugLightingSpecularColor&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _AmbientOcclusionTexture = Shader.PropertyToID(<span class="hljs-string">&quot;_AmbientOcclusionTexture&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DebugMipMapMode = Shader.PropertyToID(<span class="hljs-string">&quot;_DebugMipMapMode&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _UseTileLightList = Shader.PropertyToID(<span class="hljs-string">&quot;_UseTileLightList&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _FrameCount     = Shader.PropertyToID(<span class="hljs-string">&quot;_FrameCount&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _Time           = Shader.PropertyToID(<span class="hljs-string">&quot;_Time&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _LastTime       = Shader.PropertyToID(<span class="hljs-string">&quot;_LastTime&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _SinTime        = Shader.PropertyToID(<span class="hljs-string">&quot;_SinTime&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _CosTime        = Shader.PropertyToID(<span class="hljs-string">&quot;_CosTime&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> unity_DeltaTime = Shader.PropertyToID(<span class="hljs-string">&quot;unity_DeltaTime&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _EnvLightSkyEnabled = Shader.PropertyToID(<span class="hljs-string">&quot;_EnvLightSkyEnabled&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _AmbientOcclusionParam = Shader.PropertyToID(<span class="hljs-string">&quot;_AmbientOcclusionParam&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _SkyTexture = Shader.PropertyToID(<span class="hljs-string">&quot;_SkyTexture&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _SkyTextureMipCount = Shader.PropertyToID(<span class="hljs-string">&quot;_SkyTextureMipCount&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _EnableSubsurfaceScattering = Shader.PropertyToID(<span class="hljs-string">&quot;_EnableSubsurfaceScattering&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _TransmittanceMultiplier = Shader.PropertyToID(<span class="hljs-string">&quot;_TransmittanceMultiplier&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _TexturingModeFlags = Shader.PropertyToID(<span class="hljs-string">&quot;_TexturingModeFlags&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _TransmissionFlags = Shader.PropertyToID(<span class="hljs-string">&quot;_TransmissionFlags&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ThicknessRemaps = Shader.PropertyToID(<span class="hljs-string">&quot;_ThicknessRemaps&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ShapeParams = Shader.PropertyToID(<span class="hljs-string">&quot;_ShapeParams&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _HalfRcpVariancesAndWeights = Shader.PropertyToID(<span class="hljs-string">&quot;_HalfRcpVariancesAndWeights&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _TransmissionTintsAndFresnel0 = Shader.PropertyToID(<span class="hljs-string">&quot;_TransmissionTintsAndFresnel0&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> specularLightingUAV = Shader.PropertyToID(<span class="hljs-string">&quot;specularLightingUAV&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> diffuseLightingUAV = Shader.PropertyToID(<span class="hljs-string">&quot;diffuseLightingUAV&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> g_TileListOffset = Shader.PropertyToID(<span class="hljs-string">&quot;g_TileListOffset&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _LtcData = Shader.PropertyToID(<span class="hljs-string">&quot;_LtcData&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _LtcGGXMatrix = Shader.PropertyToID(<span class="hljs-string">&quot;_LtcGGXMatrix&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _LtcDisneyDiffuseMatrix = Shader.PropertyToID(<span class="hljs-string">&quot;_LtcDisneyDiffuseMatrix&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _LtcMultiGGXFresnelDisneyDiffuse = Shader.PropertyToID(<span class="hljs-string">&quot;_LtcMultiGGXFresnelDisneyDiffuse&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DeferredShadowTexture = Shader.PropertyToID(<span class="hljs-string">&quot;_DeferredShadowTexture&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DeferredShadowTextureUAV = Shader.PropertyToID(<span class="hljs-string">&quot;_DeferredShadowTextureUAV&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DirectionalShadowIndex = Shader.PropertyToID(<span class="hljs-string">&quot;_DirectionalShadowIndex&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DirectionalContactShadowParams = Shader.PropertyToID(<span class="hljs-string">&quot;_ScreenSpaceShadowsParameters&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DirectionalContactShadowSampleCount = Shader.PropertyToID(<span class="hljs-string">&quot;_SampleCount&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DirectionalLightDirection = Shader.PropertyToID(<span class="hljs-string">&quot;_DirectionalLightDirection&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _PunctualLightPosition = Shader.PropertyToID(<span class="hljs-string">&quot;_PunctualLightPosition&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _StencilMask = Shader.PropertyToID(<span class="hljs-string">&quot;_StencilMask&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _StencilRef = Shader.PropertyToID(<span class="hljs-string">&quot;_StencilRef&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _StencilCmp = Shader.PropertyToID(<span class="hljs-string">&quot;_StencilCmp&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _InputDepth = Shader.PropertyToID(<span class="hljs-string">&quot;_InputDepthTexture&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _SrcBlend = Shader.PropertyToID(<span class="hljs-string">&quot;_SrcBlend&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DstBlend = Shader.PropertyToID(<span class="hljs-string">&quot;_DstBlend&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _SSSHTile = Shader.PropertyToID(<span class="hljs-string">&quot;_SSSHTile&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _StencilTexture = Shader.PropertyToID(<span class="hljs-string">&quot;_StencilTexture&quot;</span>);<br><br>  <span class="hljs-comment">// all decal properties</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _NormalToWorldID = Shader.PropertyToID(<span class="hljs-string">&quot;_NormalToWorld&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DecalAtlas2DID = Shader.PropertyToID(<span class="hljs-string">&quot;_DecalAtlas2D&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DecalAtlasID = Shader.PropertyToID(<span class="hljs-string">&quot;_DecalAtlas&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DecalHTileTexture = Shader.PropertyToID(<span class="hljs-string">&quot;_DecalHTileTexture&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DecalIndexShift = Shader.PropertyToID(<span class="hljs-string">&quot;_DecalIndexShift&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DecalCount = Shader.PropertyToID(<span class="hljs-string">&quot;_DecalCount&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DecalDatas = Shader.PropertyToID(<span class="hljs-string">&quot;_DecalDatas&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _WorldSpaceCameraPos = Shader.PropertyToID(<span class="hljs-string">&quot;_WorldSpaceCameraPos&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ViewMatrix = Shader.PropertyToID(<span class="hljs-string">&quot;_ViewMatrix&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _InvViewMatrix = Shader.PropertyToID(<span class="hljs-string">&quot;_InvViewMatrix&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ProjMatrix = Shader.PropertyToID(<span class="hljs-string">&quot;_ProjMatrix&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _InvProjMatrix = Shader.PropertyToID(<span class="hljs-string">&quot;_InvProjMatrix&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _NonJitteredViewProjMatrix = Shader.PropertyToID(<span class="hljs-string">&quot;_NonJitteredViewProjMatrix&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ViewProjMatrix = Shader.PropertyToID(<span class="hljs-string">&quot;_ViewProjMatrix&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _InvViewProjMatrix = Shader.PropertyToID(<span class="hljs-string">&quot;_InvViewProjMatrix&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DetViewMatrix = Shader.PropertyToID(<span class="hljs-string">&quot;_DetViewMatrix&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ZBufferParams = Shader.PropertyToID(<span class="hljs-string">&quot;_ZBufferParams&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ProjectionParams = Shader.PropertyToID(<span class="hljs-string">&quot;_ProjectionParams&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> unity_OrthoParams = Shader.PropertyToID(<span class="hljs-string">&quot;unity_OrthoParams&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _InvProjParam = Shader.PropertyToID(<span class="hljs-string">&quot;_InvProjParam&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ScreenSize = Shader.PropertyToID(<span class="hljs-string">&quot;_ScreenSize&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ScreenParams = Shader.PropertyToID(<span class="hljs-string">&quot;_ScreenParams&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ScreenToTargetScale = Shader.PropertyToID(<span class="hljs-string">&quot;_ScreenToTargetScale&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _PrevViewProjMatrix = Shader.PropertyToID(<span class="hljs-string">&quot;_PrevViewProjMatrix&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _FrustumPlanes = Shader.PropertyToID(<span class="hljs-string">&quot;_FrustumPlanes&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _TaaFrameRotation = Shader.PropertyToID(<span class="hljs-string">&quot;_TaaFrameRotation&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ViewMatrixStereo = Shader.PropertyToID(<span class="hljs-string">&quot;_ViewMatrixStereo&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ViewProjMatrixStereo = Shader.PropertyToID(<span class="hljs-string">&quot;_ViewProjMatrixStereo&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _InvViewMatrixStereo = Shader.PropertyToID(<span class="hljs-string">&quot;_InvViewMatrixStereo&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _InvProjMatrixStereo = Shader.PropertyToID(<span class="hljs-string">&quot;_InvProjMatrixStereo&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _InvViewProjMatrixStereo = Shader.PropertyToID(<span class="hljs-string">&quot;_InvViewProjMatrixStereo&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DepthTexture                   = Shader.PropertyToID(<span class="hljs-string">&quot;_DepthTexture&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _CameraColorTexture             = Shader.PropertyToID(<span class="hljs-string">&quot;_CameraColorTexture&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _CameraSssDiffuseLightingBuffer = Shader.PropertyToID(<span class="hljs-string">&quot;_CameraSssDiffuseLightingTexture&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _CameraFilteringBuffer          = Shader.PropertyToID(<span class="hljs-string">&quot;_CameraFilteringTexture&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _IrradianceSource               = Shader.PropertyToID(<span class="hljs-string">&quot;_IrradianceSource&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _EnableDBuffer = Shader.PropertyToID(<span class="hljs-string">&quot;_EnableDBuffer&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DecalAtlasResolution = Shader.PropertyToID(<span class="hljs-string">&quot;_DecalAtlasResolution&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span>[] _GBufferTexture =<br>  &#123;<br>    Shader.PropertyToID(<span class="hljs-string">&quot;_GBufferTexture0&quot;</span>),<br>    Shader.PropertyToID(<span class="hljs-string">&quot;_GBufferTexture1&quot;</span>),<br>    Shader.PropertyToID(<span class="hljs-string">&quot;_GBufferTexture2&quot;</span>),<br>    Shader.PropertyToID(<span class="hljs-string">&quot;_GBufferTexture3&quot;</span>),<br>    Shader.PropertyToID(<span class="hljs-string">&quot;_GBufferTexture4&quot;</span>),<br>    Shader.PropertyToID(<span class="hljs-string">&quot;_GBufferTexture5&quot;</span>),<br>    Shader.PropertyToID(<span class="hljs-string">&quot;_GBufferTexture6&quot;</span>),<br>    Shader.PropertyToID(<span class="hljs-string">&quot;_GBufferTexture7&quot;</span>)<br>  &#125;;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span>[] _DBufferTexture =<br>  &#123;<br>    Shader.PropertyToID(<span class="hljs-string">&quot;_DBufferTexture0&quot;</span>),<br>    Shader.PropertyToID(<span class="hljs-string">&quot;_DBufferTexture1&quot;</span>),<br>    Shader.PropertyToID(<span class="hljs-string">&quot;_DBufferTexture2&quot;</span>),<br>    Shader.PropertyToID(<span class="hljs-string">&quot;_DBufferTexture3&quot;</span>)<br>  &#125;;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span>[] _SSSBufferTexture =<br>  &#123;<br>    Shader.PropertyToID(<span class="hljs-string">&quot;_SSSBufferTexture0&quot;</span>),<br>    Shader.PropertyToID(<span class="hljs-string">&quot;_SSSBufferTexture1&quot;</span>),<br>    Shader.PropertyToID(<span class="hljs-string">&quot;_SSSBufferTexture2&quot;</span>),<br>    Shader.PropertyToID(<span class="hljs-string">&quot;_SSSBufferTexture3&quot;</span>),<br>  &#125;;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span>[] _NormalBufferTexture =<br>  &#123;<br>    Shader.PropertyToID(<span class="hljs-string">&quot;_NormalBufferTexture0&quot;</span>),<br>    Shader.PropertyToID(<span class="hljs-string">&quot;_NormalBufferTexture1&quot;</span>),<br>    Shader.PropertyToID(<span class="hljs-string">&quot;_NormalBufferTexture2&quot;</span>),<br>    Shader.PropertyToID(<span class="hljs-string">&quot;_NormalBufferTexture3&quot;</span>),<br>  &#125;;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _SSRefractionRayMarchBehindObjects = Shader.PropertyToID(<span class="hljs-string">&quot;_SSRefractionRayMarchBehindObjects&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _SSRefractionRayMaxScreenDistance = Shader.PropertyToID(<span class="hljs-string">&quot;_SSRefractionRayMaxScreenDistance&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _SSRefractionRayBlendScreenDistance = Shader.PropertyToID(<span class="hljs-string">&quot;_SSRefractionRayBlendScreenDistance&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _SSRefractionRayLevel = Shader.PropertyToID(<span class="hljs-string">&quot;_SSRefractionRayLevel&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _SSRefractionRayMinLevel = Shader.PropertyToID(<span class="hljs-string">&quot;_SSRefractionRayMinLevel&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _SSRefractionRayMaxLevel = Shader.PropertyToID(<span class="hljs-string">&quot;_SSRefractionRayMaxLevel&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _SSRefractionRayMaxIterations = Shader.PropertyToID(<span class="hljs-string">&quot;_SSRefractionRayMaxIterations&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _SSRefractionDepthBufferThickness = Shader.PropertyToID(<span class="hljs-string">&quot;_SSRefractionDepthBufferThickness&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _SSRefractionInvScreenWeightDistance = Shader.PropertyToID(<span class="hljs-string">&quot;_SSRefractionInvScreenWeightDistance&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _SSReflectionRayMarchBehindObjects = Shader.PropertyToID(<span class="hljs-string">&quot;_SSReflectionRayMarchBehindObjects&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _SSReflectionRayMaxScreenDistance = Shader.PropertyToID(<span class="hljs-string">&quot;_SSReflectionRayMaxScreenDistance&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _SSReflectionRayBlendScreenDistance = Shader.PropertyToID(<span class="hljs-string">&quot;_SSReflectionRayBlendScreenDistance&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _SSReflectionRayLevel = Shader.PropertyToID(<span class="hljs-string">&quot;_SSReflectionRayLevel&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _SSReflectionRayMinLevel = Shader.PropertyToID(<span class="hljs-string">&quot;_SSReflectionRayMinLevel&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _SSReflectionRayMaxLevel = Shader.PropertyToID(<span class="hljs-string">&quot;_SSReflectionRayMaxLevel&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _SSReflectionRayMaxIterations = Shader.PropertyToID(<span class="hljs-string">&quot;_SSReflectionRayMaxIterations&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _SSReflectionDepthBufferThickness = Shader.PropertyToID(<span class="hljs-string">&quot;_SSReflectionDepthBufferThickness&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _SSReflectionInvScreenWeightDistance = Shader.PropertyToID(<span class="hljs-string">&quot;_SSReflectionInvScreenWeightDistance&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _SSReflectionProjectionModel = Shader.PropertyToID(<span class="hljs-string">&quot;_SSReflectionProjectionModel&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _SSReflectionEnabled = Shader.PropertyToID(<span class="hljs-string">&quot;_SSReflectionEnabled&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _VelocityTexture = Shader.PropertyToID(<span class="hljs-string">&quot;_VelocityTexture&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ShadowMaskTexture = Shader.PropertyToID(<span class="hljs-string">&quot;_ShadowMaskTexture&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DistortionTexture = Shader.PropertyToID(<span class="hljs-string">&quot;_DistortionTexture&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ColorPyramidTexture = Shader.PropertyToID(<span class="hljs-string">&quot;_ColorPyramidTexture&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DepthPyramidTexture = Shader.PropertyToID(<span class="hljs-string">&quot;_DepthPyramidTexture&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ColorPyramidSize = Shader.PropertyToID(<span class="hljs-string">&quot;_ColorPyramidSize&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ColorPyramidScale = Shader.PropertyToID(<span class="hljs-string">&quot;_ColorPyramidScale&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DepthPyramidSize = Shader.PropertyToID(<span class="hljs-string">&quot;_DepthPyramidSize&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DepthPyramidScale = Shader.PropertyToID(<span class="hljs-string">&quot;_DepthPyramidScale&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DebugColorPickerTexture = Shader.PropertyToID(<span class="hljs-string">&quot;_DebugColorPickerTexture&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ColorPickerMode = Shader.PropertyToID(<span class="hljs-string">&quot;_ColorPickerMode&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ApplyLinearToSRGB = Shader.PropertyToID(<span class="hljs-string">&quot;_ApplyLinearToSRGB&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ColorPickerFontColor = Shader.PropertyToID(<span class="hljs-string">&quot;_ColorPickerFontColor&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _RequireToFlipInputTexture = Shader.PropertyToID(<span class="hljs-string">&quot;_RequireToFlipInputTexture&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _FalseColorEnabled = Shader.PropertyToID(<span class="hljs-string">&quot;_FalseColor&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _FalseColorThresholds = Shader.PropertyToID(<span class="hljs-string">&quot;_FalseColorThresholds&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DebugFullScreenTexture = Shader.PropertyToID(<span class="hljs-string">&quot;_DebugFullScreenTexture&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _BlitTexture = Shader.PropertyToID(<span class="hljs-string">&quot;_BlitTexture&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _BlitScaleBias = Shader.PropertyToID(<span class="hljs-string">&quot;_BlitScaleBias&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _BlitMipLevel = Shader.PropertyToID(<span class="hljs-string">&quot;_BlitMipLevel&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _BlitScaleBiasRt = Shader.PropertyToID(<span class="hljs-string">&quot;_BlitScaleBiasRt&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _WorldScales = Shader.PropertyToID(<span class="hljs-string">&quot;_WorldScales&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _FilterKernels = Shader.PropertyToID(<span class="hljs-string">&quot;_FilterKernels&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _FilterKernelsBasic = Shader.PropertyToID(<span class="hljs-string">&quot;_FilterKernelsBasic&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _HalfRcpWeightedVariances = Shader.PropertyToID(<span class="hljs-string">&quot;_HalfRcpWeightedVariances&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _CameraDepthTexture = Shader.PropertyToID(<span class="hljs-string">&quot;_CameraDepthTexture&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _CameraMotionVectorsTexture = Shader.PropertyToID(<span class="hljs-string">&quot;_CameraMotionVectorsTexture&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _CameraMotionVectorsSize = Shader.PropertyToID(<span class="hljs-string">&quot;_CameraMotionVectorsSize&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _CameraMotionVectorsScale = Shader.PropertyToID(<span class="hljs-string">&quot;_CameraMotionVectorsScale&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _FullScreenDebugMode = Shader.PropertyToID(<span class="hljs-string">&quot;_FullScreenDebugMode&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _InputCubemap = Shader.PropertyToID(<span class="hljs-string">&quot;_InputCubemap&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _Mipmap = Shader.PropertyToID(<span class="hljs-string">&quot;_Mipmap&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _DiffusionProfile = Shader.PropertyToID(<span class="hljs-string">&quot;_DiffusionProfile&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _MaxRadius = Shader.PropertyToID(<span class="hljs-string">&quot;_MaxRadius&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ShapeParam = Shader.PropertyToID(<span class="hljs-string">&quot;_ShapeParam&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _StdDev1 = Shader.PropertyToID(<span class="hljs-string">&quot;_StdDev1&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _StdDev2 = Shader.PropertyToID(<span class="hljs-string">&quot;_StdDev2&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _LerpWeight = Shader.PropertyToID(<span class="hljs-string">&quot;_LerpWeight&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _HalfRcpVarianceAndWeight1 = Shader.PropertyToID(<span class="hljs-string">&quot;_HalfRcpVarianceAndWeight1&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _HalfRcpVarianceAndWeight2 = Shader.PropertyToID(<span class="hljs-string">&quot;_HalfRcpVarianceAndWeight2&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _TransmissionTint = Shader.PropertyToID(<span class="hljs-string">&quot;_TransmissionTint&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _ThicknessRemap = Shader.PropertyToID(<span class="hljs-string">&quot;_ThicknessRemap&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _Cubemap = Shader.PropertyToID(<span class="hljs-string">&quot;_Cubemap&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _SkyParam = Shader.PropertyToID(<span class="hljs-string">&quot;_SkyParam&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _PixelCoordToViewDirWS = Shader.PropertyToID(<span class="hljs-string">&quot;_PixelCoordToViewDirWS&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _Size = Shader.PropertyToID(<span class="hljs-string">&quot;_Size&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _Source4 = Shader.PropertyToID(<span class="hljs-string">&quot;_Source4&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _Result1 = Shader.PropertyToID(<span class="hljs-string">&quot;_Result1&quot;</span>);<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _AtmosphericScatteringType      = Shader.PropertyToID(<span class="hljs-string">&quot;_AtmosphericScatteringType&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _AmbientProbeCoeffs             = Shader.PropertyToID(<span class="hljs-string">&quot;_AmbientProbeCoeffs&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _GlobalExtinction               = Shader.PropertyToID(<span class="hljs-string">&quot;_GlobalExtinction&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _GlobalScattering               = Shader.PropertyToID(<span class="hljs-string">&quot;_GlobalScattering&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _GlobalAnisotropy               = Shader.PropertyToID(<span class="hljs-string">&quot;_GlobalAnisotropy&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _CornetteShanksConstant         = Shader.PropertyToID(<span class="hljs-string">&quot;_CornetteShanksConstant&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _VBufferResolution              = Shader.PropertyToID(<span class="hljs-string">&quot;_VBufferResolution&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _VBufferSliceCount              = Shader.PropertyToID(<span class="hljs-string">&quot;_VBufferSliceCount&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _VBufferUvScaleAndLimit         = Shader.PropertyToID(<span class="hljs-string">&quot;_VBufferUvScaleAndLimit&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _VBufferDepthEncodingParams     = Shader.PropertyToID(<span class="hljs-string">&quot;_VBufferDepthEncodingParams&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _VBufferDepthDecodingParams     = Shader.PropertyToID(<span class="hljs-string">&quot;_VBufferDepthDecodingParams&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _VBufferPrevResolution          = Shader.PropertyToID(<span class="hljs-string">&quot;_VBufferPrevResolution&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _VBufferPrevSliceCount          = Shader.PropertyToID(<span class="hljs-string">&quot;_VBufferPrevSliceCount&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _VBufferPrevUvScaleAndLimit     = Shader.PropertyToID(<span class="hljs-string">&quot;_VBufferPrevUvScaleAndLimit&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _VBufferPrevDepthEncodingParams = Shader.PropertyToID(<span class="hljs-string">&quot;_VBufferPrevDepthEncodingParams&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _VBufferPrevDepthDecodingParams = Shader.PropertyToID(<span class="hljs-string">&quot;_VBufferPrevDepthDecodingParams&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _VBufferCoordToViewDirWS        = Shader.PropertyToID(<span class="hljs-string">&quot;_VBufferCoordToViewDirWS&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _VBufferDensity                 = Shader.PropertyToID(<span class="hljs-string">&quot;_VBufferDensity&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _VBufferLighting                = Shader.PropertyToID(<span class="hljs-string">&quot;_VBufferLighting&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _VBufferLightingIntegral        = Shader.PropertyToID(<span class="hljs-string">&quot;_VBufferLightingIntegral&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _VBufferLightingHistory         = Shader.PropertyToID(<span class="hljs-string">&quot;_VBufferLightingHistory&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _VBufferLightingFeedback        = Shader.PropertyToID(<span class="hljs-string">&quot;_VBufferLightingFeedback&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _VBufferSampleOffset            = Shader.PropertyToID(<span class="hljs-string">&quot;_VBufferSampleOffset&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _VolumeBounds                   = Shader.PropertyToID(<span class="hljs-string">&quot;_VolumeBounds&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _VolumeData                     = Shader.PropertyToID(<span class="hljs-string">&quot;_VolumeData&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _NumVisibleDensityVolumes       = Shader.PropertyToID(<span class="hljs-string">&quot;_NumVisibleDensityVolumes&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _VolumeMaskAtlas                = Shader.PropertyToID(<span class="hljs-string">&quot;_VolumeMaskAtlas&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _VolumeMaskDimensions           = Shader.PropertyToID(<span class="hljs-string">&quot;_VolumeMaskDimensions&quot;</span>);<br><br>  <span class="hljs-comment">// Preintegrated texture name</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _PreIntegratedFGD_GGXDisneyDiffuse = Shader.PropertyToID(<span class="hljs-string">&quot;_PreIntegratedFGD_GGXDisneyDiffuse&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _PreIntegratedFGD_CharlieAndCloth = Shader.PropertyToID(<span class="hljs-string">&quot;_PreIntegratedFGD_CharlieAndCloth&quot;</span>);<br>&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>


      
      <p align="right"><a class="morebtn" href="/2022/07/09/HDRPsource/3.%E6%B8%B2%E6%9F%93%E5%8F%82%E6%95%B0/" title="渲染队列">阅读全文</a></p>
    </main>
    <footer class="post-footer">
      
    </footer>
  </article>
  
  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/12/"><i class="fas fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><span class="page-number current">13</span><a class="page-number" href="/page/14/">14</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><a class="extend next" rel="next" href="/page/14/"><i class="fas fa-angle-right" aria-label="下一页"></i></a>
  </nav>
  
  
  

<div class="comments" id="comments">
  
  
  
</div>



  
</div>

          </div>
          
          
          
<aside class="sidebar" id="sidebar" style="background: url(/images/background.png);">
  
  <div class="search">
    <div class="form-group">
      <i class="fas fa-search"></i><input type="search" id="search-input" name="q" results="0" placeholder="搜索" class="form-control"/>
    </div>
  </div>
  <div class="search-result-box" id="search-result"></div>
  
  
<div class="info sidebar-item" id="info">
  
  <img class="author-avatar" src="/images/avatar.jpg" alt="leinlin">
  
  <h1 class="author-name">leinlin</h1>
  <h2 class="author-description"></h2>
  <div class="site-count">
    
    
    
    
    <div class="categories-count count-block">
      <div class="site-count-title">分类</div>
      <div><a href="/categories/">13</a></div>
    </div>
    
    
  </div>
  
  <div class="rss">
    <a class="rss-link button sidebar-item" href="/atom.xml"><i class="fas fa-rss"></i>RSS</a>
  </div>
  
</div>


  <div class="sidebar-sticky">
    
    
    <hr>
    <div class="social-link sidebar-item">
      <div><i class="far fa-address-card"></i>社交链接</p></div>
      <ul>
        
        <li><i class="fab fa-github"></i><a href="https://leinlin.github.com/" target="_blank">GitHub</a></li>
        
      </ul>
    </div>
    
    
  </div>
</aside>


          
        </div>
      </div>
    </main>
    
<footer id="footer" class="footer" style="background: #33363b;">
  <div class="container">
    <div class="back-to-top">
      <button id="back-to-top"><i class="fas fa-angle-double-up" aria-label="回到顶部"></i></button>
    </div>
    <div class="footer-container">
      <div class="footer-left">
        <div class="copyright">
          <span class="author">leinlin</span><span class="year"><i class="far fa-copyright"></i>2022</span>
        </div>
        
        <div class="busuanzi">
          <span id="busuanzi_container_site_pv"><i class="fas fa-eye" aria-label="站点点击量" aria-hidden="false"></i><span id="busuanzi_value_site_pv"></span></span><span id="busuanzi_container_site_uv"><i class="fas fa-user" aria-label="站点用户数" aria-hidden="false"></i><span id="busuanzi_value_site_uv"></span></span><span id="busuanzi_container_page_pv"><i class="far fa-file-alt"></i><span id="busuanzi_value_page_pv" aria-label="页面点击量" aria-hidden="false"></span></span>
        </div>
        
      </div>
      <div class="footer-right">
        <div class="custom-info">
          
          托管于<i class="fab fa-github-alt"></i><a href="https://pages.github.com/" target="_blank">GitHub Pages</a>
          
        </div>
        <div class="powered-by">
          由 <a href="https://hexo.io/" target="_blank">Hexo</a> 强力驱动 | 主题 <a href="https://github.com/AlynxZhou/hexo-theme-aria/" target="_blank">ARIA</a>
        </div>
      </div>
    </div>
  </div>
</footer>


  <script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
